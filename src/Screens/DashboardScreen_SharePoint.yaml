Screens:
  DashboardScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =Set(varActiveScreen, "Dashboard"); 
        If(IsBlank(varCurrentUser), 
          Set(varCurrentUser, LookUp(NguoiDung, Email = "demo@company.com"))
        );
        If(IsBlank(varCurrentUser),
          Set(varCurrentUser, {
            MaNhanVien: "EMP001",
            HoTen: "Nguyễn Văn An", 
            Email: "demo@company.com",
            MaVaiTro: "Employee",
            ChucDanh: {Value: "Nhân viên"},
            MaDonVi: "IT",
            TrangThai: {Value: "HoatDong"}
          })
        );
        Set(varDemoUsers, Table(
          {ID: "EMP001", HoTen: "Nguyễn Văn An", MaVaiTro: "Employee", ChucDanh: "Nhân viên"},
          {ID: "MGR001", HoTen: "Trần Thị Bình", MaVaiTro: "Manager", ChucDanh: "Trưởng phòng"},
          {ID: "HR001", HoTen: "Lê Văn Cường", MaVaiTro: "HR", ChucDanh: "Chuyên viên"}
        ));
        Set(varDemoLeaveTypes, Table(
          {ID: "LT001", TenLoai: "Phép năm", CoLuong: true, MaLoai: "Annual"},
          {ID: "LT002", TenLoai: "Ốm đau", CoLuong: true, MaLoai: "Sick"}, 
          {ID: "LT003", TenLoai: "Việc cá nhân", CoLuong: false, MaLoai: "Personal"}
        ));
        Set(varDashboardStats, {
          TotalLeave: 12, 
          UsedLeave: 3, 
          RemainingLeave: 9, 
          PendingRequests: 1, 
          ApprovedRequests: 2, 
          RejectedRequests: 0
        }); 
        Set(varNavCollapsed, false); 
        Set(varMobileMenuOpen, false);
        Set(varPendingApprovalsCount, 0);
        Set(varMyRecentLeaves, Table(
          {
            ID: "REQ001",
            NgayBatDau: DateAdd(Today(), -5), 
            NgayKetThuc: DateAdd(Today(), -4), 
            SoNgayNghi: 2, 
            TrangThai: "DaDuyet",
            MaLoai: "Annual",
            MaNguoiDung: "EMP001"
          },
          {
            ID: "REQ002",
            NgayBatDau: DateAdd(Today(), -10), 
            NgayKetThuc: DateAdd(Today(), -8), 
            SoNgayNghi: 3, 
            TrangThai: "ChoDuyetCap1",
            MaLoai: "Sick",
            MaNguoiDung: "EMP001"
          }
        ))
    Children:
      - 'Dashboard.Header':
          Control: CanvasComponent
          ComponentName: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =Parent.Height * 0.08
            UserName: =varCurrentUser.HoTen
            UserRole: =varCurrentUser.MaVaiTro
            ShowNotification: =true
            NotificationCount: =varPendingApprovalsCount
            
      - 'Dashboard.Navigation':
          Control: CanvasComponent
          ComponentName: NavigationComponent
          Properties:
            X: =0
            Y: ='Dashboard.Header'.Height
            # Use component's default width
            Width: =App.Width * 0.2
            Height: =Parent.Height - 'Dashboard.Header'.Height
            UserRole: =varCurrentUser.MaVaiTro
            ActiveScreen: =varActiveScreen
            # Add missing IsCollapsed property
            IsCollapsed: =varNavCollapsed
            OnNavigate: |
              =true
            OnToggleCollapse: |
              =Set(varNavCollapsed, !varNavCollapsed)
            
            
      - 'Dashboard.Content.Container':    
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Dashboard.Navigation'.Width
            Y: ='Dashboard.Header'.Height
            Width: =Parent.Width - 'Dashboard.Navigation'.Width
            Height: =Parent.Height - 'Dashboard.Header'.Height
          Children:
            # Content Padding Container
            - 'Dashboard.Content.Padded':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: =Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.96
                Children:
                  # Welcome Section
                  - 'Dashboard.Content.Welcome':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.12
                      Children:
                        - 'Dashboard.Content.Welcome.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(230, 230, 230, 1)
                              BorderThickness: =1
                              
                        - 'Dashboard.Content.Title':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.45
                              Text: ="Chào mừng, " & varCurrentUser.HoTen
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =20
                              
                        - 'Dashboard.Content.Subtitle':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.55
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.35
                              Text: ="Phòng ban:" & " " & "Phòng Công nghệ thông tin" & " | Chức danh:" & " " & varCurrentUser.ChucDanh.Value
                              Color: =RGBA(108, 117, 125, 1)
                              Font: =Font.'Open Sans'
                              Size: =14
            
            # Stats Cards Section
            - 'Dashboard.Stats.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =0
                  Y: ='Dashboard.Content.Welcome'.Y + 'Dashboard.Content.Welcome'.Height + Parent.Height * 0.02
                  Width: =Parent.Width
                  Height: =Parent.Height * 0.32
                Children:
                  - 'Dashboard.Stats.Background':
                      Control: Rectangle
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height
                        Fill: =RGBA(255, 255, 255, 1)
                        BorderColor: =RGBA(230, 230, 230, 1)
                        BorderThickness: =1
                        
                  # Leave Balance Stats Row
                  - 'Dashboard.Stats.LeaveBalance.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =Parent.Width * 0.02
                        Y: =Parent.Height * 0.05
                        Width: =Parent.Width * 0.96
                        Height: =Parent.Height * 0.42
                      Children:
                        - 'Dashboard.Stats.TotalLeave':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: =0
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Tổng số ngày phép"
                              Value: =varDashboardStats.TotalLeave
                              Icon: ="CalendarBlank"
                              Color: =RGBA(33, 150, 243, 1)
                              Subtitle: ="Năm " & Year(Today())
                              
                        - 'Dashboard.Stats.UsedLeave':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: ='Dashboard.Stats.TotalLeave'.X + 'Dashboard.Stats.TotalLeave'.Width + Parent.Width * 0.02
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Đã sử dụng"
                              Value: =varDashboardStats.UsedLeave
                              Icon: ="CheckBadge"
                              Color: =RGBA(76, 175, 80, 1)
                              Subtitle: ="Ngày đã nghỉ"
                              
                        - 'Dashboard.Stats.RemainingLeave':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: ='Dashboard.Stats.UsedLeave'.X + 'Dashboard.Stats.UsedLeave'.Width + Parent.Width * 0.02
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Còn lại"
                              Value: =varDashboardStats.RemainingLeave
                              Icon: ="Clock"
                              Color: =RGBA(255, 152, 0, 1)
                              Subtitle: ="Ngày có thể nghỉ"
                              
                  # Request Status Stats Row
                  - 'Dashboard.Stats.RequestStatus.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =Parent.Width * 0.02
                        Y: =Parent.Height * 0.53
                        Width: =Parent.Width * 0.96
                        Height: =Parent.Height * 0.42
                      Children:
                        - 'Dashboard.Stats.PendingRequests':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: =0
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Chờ phê duyệt"
                              Value: =varDashboardStats.PendingRequests
                              Icon: ="Clock"
                              Color: =RGBA(255, 193, 7, 1)
                              Subtitle: ="Đơn đang chờ"
                              
                        - 'Dashboard.Stats.ApprovedRequests':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: ='Dashboard.Stats.PendingRequests'.X + 'Dashboard.Stats.PendingRequests'.Width + Parent.Width * 0.02
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Đã phê duyệt"
                              Value: =varDashboardStats.ApprovedRequests
                              Icon: ="CheckBadge"
                              Color: =RGBA(76, 175, 80, 1)
                              Subtitle: ="Đơn được duyệt"
                              
                        - 'Dashboard.Stats.RejectedRequests':
                            Control: CanvasComponent
                            ComponentName: StatsCardComponent
                            Properties:
                              X: ='Dashboard.Stats.ApprovedRequests'.X + 'Dashboard.Stats.ApprovedRequests'.Width + Parent.Width * 0.02
                              Y: =0
                              Width: =(Parent.Width - Parent.Width * 0.04) / 3
                              Height: =Parent.Height
                              Title: ="Bị từ chối"
                              Value: =varDashboardStats.RejectedRequests
                              Icon: ="Cancel"
                              Color: =RGBA(244, 67, 54, 1)
                              Subtitle: ="Đơn bị từ chối"
                              
            # Recent Requests and Quick Actions Section
            - 'Dashboard.Bottom.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =0
                  Y: ='Dashboard.Stats.Container'.Y + 'Dashboard.Stats.Container'.Height + Parent.Height * 0.02
                  Width: =Parent.Width
                  Height: =Parent.Height * 0.52
                Children:
                  # Recent Requests Section
                  - 'Dashboard.RecentRequests.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width * 0.65
                        Height: =Parent.Height
                      Children:
                        - 'Dashboard.RecentRequests.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(230, 230, 230, 1)
                              BorderThickness: =1
                              
                        - 'Dashboard.RecentRequests.Header':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.05
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.15
                              Text: ="Đơn nghỉ phép gần đây"
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Dashboard.RecentRequests.Gallery':
                            Control: Gallery
                            Variant: Vertical
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.2
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.75
                              Items: =varMyRecentLeaves
                              TemplateSize: =Self.Height / 3
                              TemplatePadding: =4
                            Children:
                              - 'RecentRequest.Container':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.TemplateWidth
                                    Height: =Parent.TemplateHeight - 8
                                    Fill: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", RGBA(76, 175, 80, 0.1), 
                                      "TuChoi", RGBA(244, 67, 54, 0.1), 
                                      "ChoDuyetCap1", RGBA(255, 193, 7, 0.1),
                                      "ChoDuyetCap2", RGBA(255, 193, 7, 0.1),
                                      "ChoDuyetCap3", RGBA(255, 193, 7, 0.1),
                                      RGBA(128, 128, 128, 0.1))
                                    BorderColor: =RGBA(230, 230, 230, 1)
                                    BorderThickness: =1
                                    OnSelect: |
                                      =Navigate(MyLeavesScreen)
                                    
                              - 'RecentRequest.Date':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.02
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.3
                                    Height: =Parent.TemplateHeight * 0.35
                                    Text: =Text(ThisItem.NgayBatDau, "dd/mm/yyyy")
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =10
                                    
                              - 'RecentRequest.Type':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.35
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.3
                                    Height: =Parent.TemplateHeight * 0.35
                                    Text: =Switch(ThisItem.MaLoai, "Annual", "Phép năm", "Sick", "Ốm đau", "Personal", "Cá nhân", "Phép năm")
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =10
                                    
                              - 'RecentRequest.Status':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.68
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.3
                                    Height: =Parent.TemplateHeight * 0.35
                                    Text: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", "Đã duyệt", 
                                      "TuChoi", "Từ chối", 
                                      "ChoDuyetCap1", "Chờ duyệt",
                                      "ChoDuyetCap2", "Chờ duyệt", 
                                      "ChoDuyetCap3", "Chờ duyệt",
                                      "Huy", "Đã hủy", 
                                      "Đang xử lý")
                                    Color: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", RGBA(76, 175, 80, 1), 
                                      "TuChoi", RGBA(244, 67, 54, 1), 
                                      "ChoDuyetCap1", RGBA(255, 152, 0, 1),
                                      "ChoDuyetCap2", RGBA(255, 152, 0, 1),
                                      "ChoDuyetCap3", RGBA(255, 152, 0, 1),
                                      RGBA(128, 128, 128, 1))
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =10
                                    
                              - 'RecentRequest.Days':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.02
                                    Y: =Parent.TemplateHeight * 0.55
                                    Width: =Parent.TemplateWidth * 0.96
                                    Height: =Parent.TemplateHeight * 0.35
                                    Text: =ThisItem.SoNgayNghi & " ngày (" & Text(ThisItem.NgayBatDau, "dd/mm") & " - " & Text(ThisItem.NgayKetThuc, "dd/mm") & ")"
                                    Color: =RGBA(108, 117, 125, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =9
                  
                  # Quick Actions Section
                  - 'Dashboard.QuickActions.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: ='Dashboard.RecentRequests.Container'.X + 'Dashboard.RecentRequests.Container'.Width + Parent.Width * 0.02
                        Y: =0
                        Width: =Parent.Width * 0.33
                        Height: =Parent.Height
                      Children:
                        - 'Dashboard.QuickActions.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(230, 230, 230, 1)
                              BorderThickness: =1
                              
                        - 'Dashboard.QuickActions.Header':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.05
                              Width: =Parent.Width * 0.9
                              Height: =Parent.Height * 0.15
                              Text: ="Thao tác nhanh"
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Dashboard.QuickActions.NewRequest':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.25
                              Width: =Parent.Width * 0.9
                              Height: =Parent.Height * 0.15
                              Text: ="Tạo đơn nghỉ phép"
                              Variant: ="Primary"
                              Icon: ="Add"
                              OnClick: |
                                =Navigate(LeaveRequestScreen)
                                
                        - 'Dashboard.QuickActions.ViewLeaves':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.45
                              Width: =Parent.Width * 0.9
                              Height: =Parent.Height * 0.15
                              Text: ="Xem đơn của tôi"
                              Variant: ="Outline"
                              Icon: ="DocumentWithContent"
                              OnClick: |
                                =Navigate(MyLeavesScreen)
                                
                        - 'Dashboard.QuickActions.Calendar':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.65
                              Width: =Parent.Width * 0.9
                              Height: =Parent.Height * 0.15
                              Text: ="Lịch nghỉ phép"
                              Variant: ="Outline"
                              Icon: ="CalendarBlank"
                              OnClick: |
                                =Navigate(CalendarScreen)

