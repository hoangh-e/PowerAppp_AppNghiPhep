Screens:
  LoginScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =Set(varLoginError, ""); Set(varIsTraditionalLoading, false); Set(varShowLoginForm, true);
        Set(varLoginSuccess, false); Set(varLoggedInUserEmail, ""); Set(varSessionValid, false);
        Set(UserSession, {
          Id: "",
          Name: "", 
          Email: "",
          Role: "",
          Permission: 0,
          NguoiQuanLyId: "",
          HoTen: "",
          MaVaiTro: "",
          ChucDanh: "",
          MaDonVi: "",
          TrangThai: ""
        });
        Set(varLocalLoginReset, true)
    Children:
      # ===== MAIN CONTAINER =====
      - 'Login.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: =(Parent.Width - Self.Width) / 2
            Y: =(Parent.Height - Self.Height) / 2
            Width: =Parent.Width * 0.35
            Height: =Parent.Height * 0.75
          Children:
            # White Background for form
            - 'Login.Form.Background':
                Control: Rectangle
                Properties:
                  X: =0
                  Y: =0
                  Width: =Parent.Width
                  Height: =Parent.Height
                  Fill: =RGBA(255, 255, 255, 1)
                  BorderColor: =RGBA(224, 224, 224, 1)
                  BorderThickness: =1

            # ===== HEADER SECTION =====
            # Logo Icon
            - 'Login.Logo.Icon':
                Control: Classic/Icon
                Properties:
                  X: =(Parent.Width - Self.Width) / 2
                  Y: =Parent.Height * 0.08
                  Width: =Parent.Height * 0.08
                  Height: =Parent.Height * 0.08
                  Icon: =Icon.CalendarBlank
                  Color: =RGBA(33, 150, 243, 1)

            # Title
            - 'Login.Title':
                Control: Label
                Properties:
                  X: =0
                  Y: ='Login.Logo.Icon'.Y + 'Login.Logo.Icon'.Height + Parent.Height * 0.02
                  Width: =Parent.Width
                  Height: =Parent.Height * 0.06
                  Text: ="ASIASHME LEAVE"
                  Color: =RGBA(55, 65, 81, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Bold
                  Size: =18
                  Align: =Align.Center

            # Subtitle
            - 'Login.Subtitle':
                Control: Label
                Properties:
                  X: =0
                  Y: ='Login.Title'.Y + 'Login.Title'.Height + Parent.Height * 0.01
                  Width: =Parent.Width
                  Height: =Parent.Height * 0.04
                  Text: ="Hệ thống quản lý nghỉ phép doanh nghiệp"
                  Color: =RGBA(107, 114, 128, 1)
                  Font: =Font.'Open Sans'
                  Size: =12
                  Align: =Align.Center

            # ===== FORM SECTION =====
            # Email Label
            - 'Login.Email.Label':
                Control: Label
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Subtitle'.Y + 'Login.Subtitle'.Height + Parent.Height * 0.04
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.04
                  Text: ="Email"
                  Color: =RGBA(55, 65, 81, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Semibold
                  Size: =13

            # Email Input
            - 'Login.Email.Input':
                Control: Classic/TextInput
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Email.Label'.Y + 'Login.Email.Label'.Height + Parent.Height * 0.01
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.06
                  HintText: ="Nhập email của bạn"
                  Color: =RGBA(55, 65, 81, 1)
                  Fill: =RGBA(255, 255, 255, 1)
                  BorderColor: =RGBA(224, 224, 224, 1)
                  BorderThickness: =1
                  Font: =Font.'Open Sans'
                  Size: =13

            # Password Label
            - 'Login.Password.Label':
                Control: Label
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Email.Input'.Y + 'Login.Email.Input'.Height + Parent.Height * 0.025
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.04
                  Text: ="Mật khẩu"
                  Color: =RGBA(55, 65, 81, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Semibold
                  Size: =13

            # Password Input
            - 'Login.Password.Input':
                Control: Classic/TextInput
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Password.Label'.Y + 'Login.Password.Label'.Height + Parent.Height * 0.01
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.06
                  Mode: =TextMode.Password
                  HintText: ="Nhập mật khẩu"
                  Color: =RGBA(55, 65, 81, 1)
                  Fill: =RGBA(255, 255, 255, 1)
                  BorderColor: =RGBA(224, 224, 224, 1)
                  BorderThickness: =1
                  Font: =Font.'Open Sans'
                  Size: =13

            # Error Message
            - 'Login.Error.Message':
                Control: Label
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Password.Input'.Y + 'Login.Password.Input'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.04
                  Text: =varLoginError
                  Color: =RGBA(244, 67, 54, 1)
                  Font: =Font.'Open Sans'
                  Size: =12
                  Align: =Align.Center
                  Visible: =Not(IsBlank(varLoginError))

            # Login Button
            - 'Login.Button':
                Control: Classic/Button
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Error.Message'.Y + 'Login.Error.Message'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.07
                  Text: =If(varIsTraditionalLoading, "Đang đăng nhập...", "Đăng nhập")
                  Fill: =If(varIsTraditionalLoading, RGBA(158, 158, 158, 1), RGBA(33, 150, 243, 1))
                  Color: =RGBA(255, 255, 255, 1)
                  BorderColor: =If(varIsTraditionalLoading, RGBA(158, 158, 158, 1), RGBA(33, 150, 243, 1))
                  BorderThickness: =1
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Semibold
                  Size: =14
                  HoverFill: =If(varIsTraditionalLoading, RGBA(158, 158, 158, 1), RGBA(25, 118, 210, 1))
                  HoverBorderColor: =If(varIsTraditionalLoading, RGBA(158, 158, 158, 1), RGBA(25, 118, 210, 1))
                  HoverColor: =RGBA(255, 255, 255, 1)
                  PressedFill: =If(varIsTraditionalLoading, RGBA(158, 158, 158, 1), RGBA(21, 101, 192, 1))
                  PressedColor: =RGBA(255, 255, 255, 1)
                  DisplayMode: =If(Or(IsBlank('Login.Email.Input'.Text), IsBlank('Login.Password.Input'.Text), varIsTraditionalLoading), DisplayMode.Disabled, DisplayMode.Edit)
                  OnSelect: |
                    =Set(varIsTraditionalLoading, true); Set(varLoginError, "");
                    With(LookUp(NguoiDung, And(Email = 'Login.Email.Input'.Text, MatKhau = 'Login.Password.Input'.Text)),
                      If(IsBlank(ThisRecord),
                        Set(varLoginError, "Email hoặc mật khẩu không đúng"); Set(varIsTraditionalLoading, false),
                        If(ThisRecord.TrangThai.Value = "HoatDong",
                          Set(varLoginSuccess, true); Set(varSessionValid, true);
                          Set(varLoggedInUserEmail, 'Login.Email.Input'.Text);
                          Set(UserSession, {
                            Name: ThisRecord.HoTen,
                            Id: ThisRecord.Title,
                            Email: ThisRecord.Email,
                            Role: Text(ThisRecord.ChucDanh.Value),
                            Permission: 7,
                            NguoiQuanLyId: If(IsBlank(ThisRecord.MaQuanLy), "", Text(ThisRecord.MaQuanLy.Value)),
                            HoTen: ThisRecord.HoTen,
                            MaVaiTro: Text(ThisRecord.MaVaiTro.Value),
                            ChucDanh: Text(ThisRecord.ChucDanh.Value),
                            MaDonVi: Text(ThisRecord.MaDonVi.Value),
                            TrangThai: Text(ThisRecord.TrangThai.Value)
                          });
                          Set(varIsTraditionalLoading, false);
                          Navigate(DashboardScreen),
                          Set(varLoginError, "Tài khoản đã bị khóa. Vui lòng liên hệ quản trị viên"); Set(varIsTraditionalLoading, false))))

            # Divider
            - 'Login.Divider':
                Control: Rectangle
                Properties:
                  X: =Parent.Width * 0.15
                  Y: ='Login.Button'.Y + 'Login.Button'.Height + Parent.Height * 0.03
                  Width: =Parent.Width * 0.7
                  Height: =1
                  Fill: =RGBA(224, 224, 224, 1)

            # Demo Section Title
            - 'Login.Demo.Title':
                Control: Label
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Divider'.Y + 'Login.Divider'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.04
                  Text: ="DEMO LOGIN"
                  Color: =RGBA(107, 114, 128, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Semibold
                  Size: =11
                  Align: =Align.Center

            # Demo Buttons Container
            - 'Login.Demo.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.08
                  Y: ='Login.Demo.Title'.Y + 'Login.Demo.Title'.Height + Parent.Height * 0.015
                  Width: =Parent.Width * 0.84
                  Height: =Parent.Height * 0.18
                Children:
                  # Demo Admin Button
                  - 'Login.Demo.Admin':
                      Control: Classic/Button
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.3
                        Text: ="Demo Admin - Toàn quyền"
                        Fill: =RGBA(248, 250, 252, 1)
                        Color: =RGBA(55, 65, 81, 1)
                        BorderColor: =RGBA(224, 224, 224, 1)
                        BorderThickness: =1
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Normal
                        Size: =12
                        HoverFill: =RGBA(237, 242, 247, 1)
                        HoverBorderColor: =RGBA(187, 222, 251, 1)
                        HoverColor: =RGBA(17, 24, 39, 1)
                        PressedFill: =RGBA(227, 242, 253, 1)
                        PressedColor: =RGBA(0, 0, 0, 1)
                        OnSelect: |
                          =Set(varLoginSuccess, true); Set(varSessionValid, true);
                          Set(varLoggedInUserEmail, "admin@demo.com");
                          Set(UserSession, {
                            Name: "Quản trị viên Demo",
                            Id: "ADMIN001",
                            Email: "admin@demo.com",
                            Role: "ADMIN",
                            Permission: 31,
                            NguoiQuanLyId: "",
                            HoTen: "Quản trị viên Demo",
                            MaVaiTro: "ADMIN",
                            ChucDanh: "Quản trị hệ thống",
                            MaDonVi: "IT",
                            TrangThai: "HoatDong"
                          });
                          Navigate(DashboardScreen)

                  # Demo Employee Button
                  - 'Login.Demo.Employee':
                      Control: Classic/Button
                      Properties:
                        X: =0
                        Y: =Parent.Height * 0.35
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.3
                        Text: ="Demo Nhân viên - Quyền cơ bản"
                        Fill: =RGBA(248, 250, 252, 1)
                        Color: =RGBA(55, 65, 81, 1)
                        BorderColor: =RGBA(224, 224, 224, 1)
                        BorderThickness: =1
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Normal
                        Size: =12
                        HoverFill: =RGBA(237, 242, 247, 1)
                        HoverBorderColor: =RGBA(187, 222, 251, 1)
                        HoverColor: =RGBA(17, 24, 39, 1)
                        PressedFill: =RGBA(227, 242, 253, 1)
                        PressedColor: =RGBA(0, 0, 0, 1)
                        OnSelect: |
                          =Set(varLoginSuccess, true); Set(varSessionValid, true);
                          Set(varLoggedInUserEmail, "employee@demo.com");
                          Set(UserSession, {
                            Name: "Nguyễn Văn An",
                            Id: "EMP001",
                            Email: "employee@demo.com",
                            Role: "Employee",
                            Permission: 3,
                            NguoiQuanLyId: "MGR001",
                            HoTen: "Nguyễn Văn An",
                            MaVaiTro: "Employee",
                            ChucDanh: "Nhân viên",
                            MaDonVi: "IT",
                            TrangThai: "HoatDong"
                          });
                          Navigate(DashboardScreen)

                  # Demo Manager Button  
                  - 'Login.Demo.Manager':
                      Control: Classic/Button
                      Properties:
                        X: =0
                        Y: =Parent.Height * 0.7
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.3
                        Text: ="Demo Quản lý - Quyền duyệt đơn"
                        Fill: =RGBA(248, 250, 252, 1)
                        Color: =RGBA(55, 65, 81, 1)
                        BorderColor: =RGBA(224, 224, 224, 1)
                        BorderThickness: =1
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Normal
                        Size: =12
                        HoverFill: =RGBA(237, 242, 247, 1)
                        HoverBorderColor: =RGBA(187, 222, 251, 1)
                        HoverColor: =RGBA(17, 24, 39, 1)
                        PressedFill: =RGBA(227, 242, 253, 1)
                        PressedColor: =RGBA(0, 0, 0, 1)
                        OnSelect: |
                          =Set(varLoginSuccess, true); Set(varSessionValid, true);
                          Set(varLoggedInUserEmail, "manager@demo.com");
                          Set(UserSession, {
                            Name: "Trần Thị Bích",
                            Id: "MGR001",
                            Email: "manager@demo.com",
                            Role: "Manager",
                            Permission: 15,
                            NguoiQuanLyId: "DIR001",
                            HoTen: "Trần Thị Bích",
                            MaVaiTro: "Manager",
                            ChucDanh: "Trưởng phòng",
                            MaDonVi: "IT",
                            TrangThai: "HoatDong"
                          });
                          Navigate(DashboardScreen)

      # Footer Info
      - 'Login.Footer':
          Control: Label
          Properties:
            X: =0
            Y: =Parent.Height * 0.95
            Width: =Parent.Width
            Height: =Parent.Height * 0.05
            Text: ="Version 2.0.0 SharePoint | Powered by Microsoft Power Platform"
            Color: =RGBA(107, 114, 128, 1)
            Font: =Font.'Open Sans'
            Size: =11
            Align: =Align.Center
