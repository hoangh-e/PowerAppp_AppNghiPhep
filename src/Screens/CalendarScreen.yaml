Screens:
  CalendarScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =Set(varActiveScreen, "Calendar");
        Set(varCurrentDate, Today());
        Set(varSelectedMonth, Month(Today()));
        Set(varSelectedYear, Year(Today()));
        Set(varCalendarView, "Personal");
        Set(varViewFormat, "Calendar");
        Set(varShowCalendarDetails, false);
        Set(varSelectedDateLeaves, Blank());
        If(IsBlank(UserSession.Id),
          Set(varPersonalLeaves, Table()),
          Set(varPersonalLeaves, Filter(DonNghiPhep, MaNguoiDung.Value = UserSession.Id))
        );
        Set(varAllLeaves, DonNghiPhep);
        If(IsBlank(UserSession.Id),
          Set(varDepartmentLeaves, Table()),
          If(IsBlank(First(NguoiDung).Title),
            Set(varDepartmentLeaves, Table()),
            With({userDept: LookUp(NguoiDung, Title = UserSession.Id)},
              If(IsBlank(userDept),
                Set(varDepartmentLeaves, Table()),
                Set(varDepartmentLeaves, Filter(DonNghiPhep, 
                  With({reqUser: LookUp(NguoiDung, Title = MaNguoiDung)}, 
                    Not(IsBlank(reqUser)) && reqUser.MaDonVi.Value = userDept.MaDonVi.Value
                  )
                ))
              )
            )
          )
        );
        Set(varHolidays, NgayLe);
        Set(varMonthStart, DateAdd(Date(varSelectedYear, varSelectedMonth, 1), -(Weekday(Date(varSelectedYear, varSelectedMonth, 1), StartOfWeek.Sunday) - 1), TimeUnit.Days));
        Set(varCalendarDays, Table());
        ForAll(Sequence(35), 
          Collect(varCalendarDays, {
            Date: DateAdd(varMonthStart, Value - 1, TimeUnit.Days),
            IsCurrentMonth: Month(DateAdd(varMonthStart, Value - 1, TimeUnit.Days)) = varSelectedMonth,
            IsToday: DateAdd(varMonthStart, Value - 1, TimeUnit.Days) = Today(),
            IsWeekend: Weekday(DateAdd(varMonthStart, Value - 1, TimeUnit.Days), StartOfWeek.Sunday) in [1, 7]
          })
        );
        Set(UserSession, {
          Id: "EMP001", 
          Name: "Nguyễn Văn An", 
          Email: "an.nguyen@company.com", 
          Role: "Employee", 
          Permission: 7,
          NguoiQuanLyId: "MGR001", 
          HoTen: "Nguyễn Văn An", 
          MaVaiTro: "Employee", 
          ChucDanh: "Nhân viên", 
          MaDonVi: "IT", 
          TrangThai: "HoatDong"
        })
    Children:
      # Header Component
      - 'Calendar.Header':
          Control: CanvasComponent
          ComponentName: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =Parent.Height * 0.065
            UserName: =UserSession.HoTen
            UserRole: =UserSession.MaVaiTro
            ShowNotification: =true
            NotificationCount: =0
            OnLogout: |
              =Set(varIsUserAuthenticated, false);
              Set(UserSession, {
                Id: "", 
                Name: "", 
                Email: "", 
                Role: "", 
                Permission: 0,
                NguoiQuanLyId: "", 
                HoTen: "", 
                MaVaiTro: "", 
                ChucDanh: "", 
                MaDonVi: "", 
                TrangThai: ""
              });
              Navigate(LoginScreen)

      # Navigation Component
      - 'Calendar.Navigation':
          Control: CanvasComponent
          ComponentName: NavigationComponent
          Properties:
            X: =0
            Y: ='Calendar.Header'.Height
            Width: =If(varNavCollapsed, App.Width * 0.045, App.Width * 0.14)
            Height: =Parent.Height - 'Calendar.Header'.Height
            UserRole: =UserSession.MaVaiTro
            ActiveScreen: ="Calendar"
            IsCollapsed: =varNavCollapsed
            DashboardScreen: =DashboardScreen
            LeaveRequestScreen: =LeaveRequestScreen
            MyLeavesScreen: =MyLeavesScreen
            CalendarScreen: =CalendarScreen
            ManagementScreen: =ManagementScreen
            ReportsScreen: =ReportsScreen
            ProfileScreen: =ProfileScreen
            OnNavigate: |
              =Set(varActiveScreen, ScreenName);
              Switch(ScreenName,
                "Dashboard", Navigate(DashboardScreen),
                "LeaveRequest", Navigate(LeaveRequestScreen),
                "MyLeaves", Navigate(MyLeavesScreen),
                "Calendar", Navigate(CalendarScreen),
                "Management", Navigate(ManagementScreen),
                "Profile", Navigate(ProfileScreen),
                "Approval", Navigate(ApprovalScreen),
                "Reports", Navigate(ReportsScreen)
              )
            OnToggleCollapse: |
              =Set(varNavCollapsed, !varNavCollapsed)
              
      # Main Content Container
      - 'Calendar.Content.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Calendar.Navigation'.Width
            Y: ='Calendar.Header'.Height
            Width: =Parent.Width - 'Calendar.Navigation'.Width
            Height: =Parent.Height - 'Calendar.Header'.Height
          Children:
            - 'Calendar.Content.Padded':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.01
                  Y: =Parent.Height * 0.01
                  Width: =Parent.Width * 0.98
                  Height: =Parent.Height * 0.98
                Children:
                  # Page Header with Controls
                  - 'Calendar.PageHeader.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.15
                      Children:
                        - 'Calendar.PageHeader.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        # Calendar Navigation
                        - 'Calendar.Nav.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.4
                              Height: =Parent.Height * 0.8
                            Children:
                              - 'Calendar.Nav.PrevButton':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =0
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.15
                                    Height: =Parent.Height * 0.6
                                    Text: ="‹"
                                    Variant: ="Outline"
                                    Size: =FontSizes.Medium
                                    OnClick: |
                                      =If(varSelectedMonth = 1,
                                        Set(varSelectedMonth, 12); Set(varSelectedYear, varSelectedYear - 1),
                                        Set(varSelectedMonth, varSelectedMonth - 1)
                                      );
                                      Set(varMonthStart, DateAdd(Date(varSelectedYear, varSelectedMonth, 1), -(Weekday(Date(varSelectedYear, varSelectedMonth, 1), StartOfWeek.Sunday) - 1), TimeUnit.Days));
                                      Clear(varCalendarDays);
                                      ForAll(Sequence(35), 
                                        Collect(varCalendarDays, {
                                          Date: DateAdd(varMonthStart, Value - 1, TimeUnit.Days),
                                          IsCurrentMonth: Month(DateAdd(varMonthStart, Value - 1, TimeUnit.Days)) = varSelectedMonth,
                                          IsToday: DateAdd(varMonthStart, Value - 1, TimeUnit.Days) = Today(),
                                          IsWeekend: Weekday(DateAdd(varMonthStart, Value - 1, TimeUnit.Days), StartOfWeek.Sunday) in [1, 7]
                                        })
                                      )
                                      
                              - 'Calendar.Nav.MonthYear':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.2
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.6
                                    Height: =Parent.Height * 0.6
                                    Text: =Concatenate("Tháng ", varSelectedMonth, " năm ", varSelectedYear)
                                    Color: =RGBA(17, 24, 39, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Large
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    
                              - 'Calendar.Nav.NextButton':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.85
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.15
                                    Height: =Parent.Height * 0.6
                                    Text: ="›"
                                    Variant: ="Outline"
                                    Size: =FontSizes.Medium
                                    OnClick: |
                                      =If(varSelectedMonth = 12,
                                        Set(varSelectedMonth, 1); Set(varSelectedYear, varSelectedYear + 1),
                                        Set(varSelectedMonth, varSelectedMonth + 1)
                                      );
                                      Set(varMonthStart, DateAdd(Date(varSelectedYear, varSelectedMonth, 1), -(Weekday(Date(varSelectedYear, varSelectedMonth, 1), StartOfWeek.Sunday) - 1), TimeUnit.Days));
                                      Clear(varCalendarDays);
                                      ForAll(Sequence(35), 
                                        Collect(varCalendarDays, {
                                          Date: DateAdd(varMonthStart, Value - 1, TimeUnit.Days),
                                          IsCurrentMonth: Month(DateAdd(varMonthStart, Value - 1, TimeUnit.Days)) = varSelectedMonth,
                                          IsToday: DateAdd(varMonthStart, Value - 1, TimeUnit.Days) = Today(),
                                          IsWeekend: Weekday(DateAdd(varMonthStart, Value - 1, TimeUnit.Days), StartOfWeek.Sunday) in [1, 7]
                                        })
                                      )
                                      
                        # View Toggle Controls
                        - 'Calendar.ViewToggle.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.45
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.25
                              Height: =Parent.Height * 0.8
                            Children:
                              - 'Calendar.ViewToggle.Label':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.35
                                    Height: =Parent.Height * 0.6
                                    Text: ="Hiển thị:"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =FontSizes.Base
                                    VerticalAlign: =VerticalAlign.Middle
                                    
                              - 'Calendar.ViewToggle.Personal':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.4
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.18
                                    Height: =Parent.Height * 0.6
                                    Text: ="CN"
                                    Variant: =If(varCalendarView = "Personal", "Primary", "Outline")
                                    Size: =FontSizes.Small
                                    OnClick: =Set(varCalendarView, "Personal")
                                    
                              - 'Calendar.ViewToggle.Department':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.62
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.18
                                    Height: =Parent.Height * 0.6
                                    Text: ="PB"
                                    Variant: =If(varCalendarView = "Department", "Primary", "Outline")
                                    Size: =FontSizes.Small
                                    OnClick: =Set(varCalendarView, "Department")
                                    
                              - 'Calendar.ViewToggle.All':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.84
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.18
                                    Height: =Parent.Height * 0.6
                                    Text: ="CT"
                                    Variant: =If(varCalendarView = "All", "Primary", "Outline")
                                    Size: =FontSizes.Small
                                    OnClick: =Set(varCalendarView, "All")
                                    
                        # Format Toggle Controls  
                        - 'Calendar.FormatToggle.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.72
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.26
                              Height: =Parent.Height * 0.8
                            Children:
                              - 'Calendar.FormatToggle.Label':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.35
                                    Height: =Parent.Height * 0.6
                                    Text: ="Dạng:"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =FontSizes.Base
                                    VerticalAlign: =VerticalAlign.Middle
                                    
                              - 'Calendar.FormatToggle.Calendar':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.4
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.28
                                    Height: =Parent.Height * 0.6
                                    Text: ="Lịch"
                                    Variant: =If(varViewFormat = "Calendar", "Primary", "Outline")
                                    Size: =FontSizes.Small
                                    OnClick: =Set(varViewFormat, "Calendar")
                                    
                              - 'Calendar.FormatToggle.List':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.72
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.28
                                    Height: =Parent.Height * 0.6
                                    Text: ="DS"
                                    Variant: =If(varViewFormat = "List", "Primary", "Outline")
                                    Size: =FontSizes.Small
                                    OnClick: =Set(varViewFormat, "List")

                  # Calendar Grid (only show when Calendar format)
                  - 'Calendar.Grid.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Calendar.PageHeader.Container'.Y + 'Calendar.PageHeader.Container'.Height + Parent.Height * 0.01
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.82
                        Visible: =varViewFormat = "Calendar"
                      Children:
                        - 'Calendar.Grid.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        # Week Days Header
                        - 'Calendar.WeekDays.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.02
                              Width: =Parent.Width * 0.96
                              Height: =Parent.Height * 0.1
                            Children:
                              - 'Calendar.WeekDays.Sunday':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="CN"
                                    Color: =RGBA(239, 68, 68, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Monday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T2"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Tuesday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7 * 2
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T3"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Wednesday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7 * 3
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T4"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Thursday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7 * 4
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T5"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Friday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7 * 5
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T6"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              - 'Calendar.WeekDays.Saturday':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width / 7 * 6
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height
                                    Text: ="T7"
                                    Color: =RGBA(239, 68, 68, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                        # Calendar Days Grid - Fixed Layout Direction (Left to Right, Top to Bottom)
                        - 'Calendar.Days.Gallery':
                            Control: Gallery
                            Variant: Vertical
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: ='Calendar.WeekDays.Container'.Y + 'Calendar.WeekDays.Container'.Height
                              Width: =Parent.Width * 0.96
                              Height: =Parent.Height * 0.88
                              Items: =varCalendarDays
                              TemplateSize: =Self.Height / 5
                              WrapCount: =7
                              BorderThickness: =0
                              Fill: =RGBA(0, 0, 0, 0)
                            Children:
                              # Day Cell Container
                              - 'Calendar.Day.Cell':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width / 7
                                    Height: =Parent.Height / 5
                                    Fill: =If(
                                      ThisItem.IsToday, RGBA(59, 130, 246, 0.1),
                                      If(Not(ThisItem.IsCurrentMonth), RGBA(249, 250, 251, 1),
                                        If(ThisItem.IsWeekend, RGBA(254, 242, 242, 1), RGBA(255, 255, 255, 1))
                                      ))
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    OnSelect: |
                                      =Switch(varCalendarView,
                                        "Personal", Set(varSelectedDateLeaves, Filter(varPersonalLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))),
                                        "Department", Set(varSelectedDateLeaves, Filter(varDepartmentLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))),
                                        "All", Set(varSelectedDateLeaves, Filter(varAllLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date)))
                                      );
                                      If(CountRows(varSelectedDateLeaves) > 0,
                                        Set(varShowCalendarDetails, true)
                                      )
                                      
                              # Day Number
                              - 'Calendar.Day.Number':
                                  Control: Label
                                  Properties:
                                    X: =(Parent.Width / 7) * 0.05
                                    Y: =(Parent.Height / 5) * 0.05
                                    Width: =(Parent.Width / 7) * 0.4
                                    Height: =(Parent.Height / 5) * 0.4
                                    Text: =Day(ThisItem.Date)
                                    Color: =If(
                                      ThisItem.IsToday, RGBA(59, 130, 246, 1),
                                      If(Not(ThisItem.IsCurrentMonth), RGBA(156, 163, 175, 1),
                                        If(ThisItem.IsWeekend, RGBA(239, 68, 68, 1), RGBA(17, 24, 39, 1))
                                      ))
                                    Font: =Font.'Open Sans'
                                    FontWeight: =If(ThisItem.IsToday, FontWeight.Bold, FontWeight.Normal)
                                    Size: =FontSizes.Large
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    
                              # Holiday Indicator - Fixed Height
                              - 'Calendar.Day.Holiday':
                                  Control: Classic/Icon
                                  Properties:
                                    X: =(Parent.Width / 7) * 0.7
                                    Y: =(Parent.Height / 5) * 0.05
                                    Width: =(Parent.Height / 5) * 0.25
                                    Height: =(Parent.Height / 5) * 0.25
                                    Icon: =Icon.CalendarBlank
                                    Color: =RGBA(251, 191, 36, 1)
                                    Visible: =CountRows(Filter(varHolidays, Ngay = Text(ThisItem.Date, "yyyy-mm-dd"))) > 0
                                    
                              # Personal Leave Indicator
                              - 'Calendar.Day.PersonalLeave':
                                  Control: Rectangle
                                  Properties:
                                    X: =(Parent.Width / 7) * 0.05
                                    Y: =(Parent.Height / 5) * 0.45
                                    Width: =(Parent.Width / 7) * 0.9
                                    Height: =(Parent.Height / 5) * 0.2
                                    Fill: =RGBA(34, 197, 94, 0.7)
                                    BorderColor: =RGBA(34, 197, 94, 1)
                                    BorderThickness: =1
                                    Visible: =And(
                                      varCalendarView = "Personal",
                                      CountRows(Filter(varPersonalLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))) > 0
                                      )
                                      
                              # Department Leave Count
                              - 'Calendar.Day.DepartmentCount':
                                  Control: Label
                                  Properties:
                                    X: =(Parent.Width / 7) * 0.05
                                    Y: =(Parent.Height / 5) * 0.45
                                    Width: =(Parent.Width / 7) * 0.9
                                    Height: =(Parent.Height / 5) * 0.25
                                    Text: =CountRows(Filter(varDepartmentLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))) & " người"
                                    Color: =RGBA(59, 130, 246, 1)
                                    Fill: =RGBA(219, 234, 254, 0.8)
                                    BorderColor: =RGBA(59, 130, 246, 1)
                                    BorderThickness: =1
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    Visible: =And(
                                      varCalendarView = "Department",
                                      CountRows(Filter(varDepartmentLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))) > 0
                                      )
                                      
                              # All Company Leave Count
                              - 'Calendar.Day.AllCount':
                                  Control: Label
                                  Properties:
                                    X: =(Parent.Width / 7) * 0.05
                                    Y: =(Parent.Height / 5) * 0.45
                                    Width: =(Parent.Width / 7) * 0.9
                                    Height: =(Parent.Height / 5) * 0.25
                                    Text: =CountRows(Filter(varAllLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))) & " người"
                                    Color: =RGBA(139, 69, 19, 1)
                                    Fill: =RGBA(254, 243, 199, 0.8)
                                    BorderColor: =RGBA(139, 69, 19, 1)
                                    BorderThickness: =1
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    Visible: =And(
                                      varCalendarView = "All",
                                      CountRows(Filter(varAllLeaves, And(NgayBatDau <= ThisItem.Date, NgayKetThuc >= ThisItem.Date))) > 0
                                      )

                  # List View (only show when List format)
                  - 'Calendar.List.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Calendar.PageHeader.Container'.Y + 'Calendar.PageHeader.Container'.Height + Parent.Height * 0.01
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.82
                        Visible: =varViewFormat = "List"
                      Children:
                        - 'Calendar.List.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        # Leave List Gallery for List View
                        - 'Calendar.List.Gallery':
                            Control: Gallery
                            Variant: Vertical
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.02
                              Width: =Parent.Width * 0.96
                              Height: =Parent.Height * 0.96
                              Items: =Switch(varCalendarView,
                                "Personal", Filter(varPersonalLeaves, And(Month(NgayBatDau) = varSelectedMonth, Year(NgayBatDau) = varSelectedYear)),
                                "Department", Filter(varDepartmentLeaves, And(Month(NgayBatDau) = varSelectedMonth, Year(NgayBatDau) = varSelectedYear)),
                                "All", Filter(varAllLeaves, And(Month(NgayBatDau) = varSelectedMonth, Year(NgayBatDau) = varSelectedYear))
                                )
                              TemplateSize: =80
                              BorderThickness: =0
                              Fill: =RGBA(0, 0, 0, 0)
                            Children:
                              - 'Calendar.List.Item':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.TemplateWidth
                                    Height: =80
                                    Fill: =RGBA(255, 255, 255, 1)
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                  Children:
                                    # Employee Info
                                    - 'Calendar.List.EmployeeName':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.02
                                          Y: =Parent.Height * 0.1
                                          Width: =Parent.Width * 0.2
                                          Height: =Parent.Height * 0.4
                                          Text: =LookUp(NguoiDung, Title = ThisItem.MaNguoiDung.Value).HoTen
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =FontSizes.Base
                                          
                                    - 'Calendar.List.Department':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.02
                                          Y: =Parent.Height * 0.55
                                          Width: =Parent.Width * 0.2
                                          Height: =Parent.Height * 0.35
                                          Text: |
                                            =With({userRecord: LookUp(NguoiDung, Title = ThisItem.MaNguoiDung.Value)}, If(IsBlank(userRecord), "", LookUp(DonVi, MaDonVi = userRecord.MaDonVi.Value).TenDonVi))
                                          Color: =RGBA(75, 85, 99, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =FontSizes.Base
                                          
                                    # Leave Details
                                    - 'Calendar.List.Period':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.24
                                          Y: =Parent.Height * 0.1
                                          Width: =Parent.Width * 0.18
                                          Height: =Parent.Width * 0.4
                                          Text: =Text(ThisItem.NgayBatDau, "dd/mm/yyyy") & " - " & Text(ThisItem.NgayKetThuc, "dd/mm/yyyy")
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =FontSizes.Base
                                          
                                    - 'Calendar.List.Days':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.24
                                          Y: =Parent.Height * 0.55
                                          Width: =Parent.Width * 0.18
                                          Height: =Parent.Height * 0.35
                                          Text: =ThisItem.SoNgayNghi & " ngày"
                                          Color: =RGBA(75, 85, 99, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =FontSizes.Base
                                          
                                    # Leave Type
                                    - 'Calendar.List.LeaveType':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.44
                                          Y: =Parent.Height * 0.1
                                          Width: =Parent.Width * 0.15
                                          Height: =Parent.Height * 0.8
                                          Text: =LookUp(LoaiNghi, MaLoai = ThisItem.MaLoai.Value).TenLoai
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =FontSizes.Base
                                          
                                    # Status
                                    - 'Calendar.List.Status':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.61
                                          Y: =(Parent.Height - Self.Height) / 2
                                          Width: =Parent.Width * 0.15
                                          Height: =Parent.Height * 0.6
                                          Text: =Switch(ThisItem.TrangThai.Value, 
                                            "ChoDuyetCap1", "Chờ duyệt",
                                            "ChoDuyetCap2", "Chờ duyệt", 
                                            "ChoDuyetCap3", "Chờ duyệt",
                                            "DaDuyet", "Đã duyệt",
                                            "TuChoi", "Từ chối",
                                            "Huy", "Đã hủy",
                                            ThisItem.TrangThai.Value)
                                          Color: =Switch(ThisItem.TrangThai.Value,
                                            "DaDuyet", RGBA(34, 197, 94, 1),
                                            "TuChoi", RGBA(239, 68, 68, 1),
                                            "Huy", RGBA(107, 114, 128, 1),
                                            RGBA(251, 191, 36, 1))
                                          Fill: =Switch(ThisItem.TrangThai.Value,
                                            "DaDuyet", RGBA(240, 253, 244, 1),
                                            "TuChoi", RGBA(254, 242, 242, 1),
                                            "Huy", RGBA(249, 250, 251, 1),
                                            RGBA(254, 243, 199, 1))
                                          BorderColor: =Switch(ThisItem.TrangThai.Value,
                                            "DaDuyet", RGBA(34, 197, 94, 1),
                                            "TuChoi", RGBA(239, 68, 68, 1),
                                            "Huy", RGBA(107, 114, 128, 1),
                                            RGBA(251, 191, 36, 1))
                                          BorderThickness: =1
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =FontSizes.Base
                                          Align: =Align.Center
                                          
                                    # Reason
                                    - 'Calendar.List.Reason':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.78
                                          Y: =(Parent.Height - Self.Height) / 2
                                          Width: =Parent.Width * 0.2
                                          Height: =Parent.Height * 0.8
                                          Text: =ThisItem.LyDo
                                          Color: =RGBA(75, 85, 99, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =FontSizes.Base
                                          Wrap: =true

      # Calendar Details Modal
      - 'Calendar.Details.Modal':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: =(Parent.Width - Parent.Width * 0.6) / 2
            Y: =(Parent.Height - Parent.Height * 0.7) / 2
            Width: =Parent.Width * 0.6
            Height: =Parent.Height * 0.7
            Fill: =RGBA(255, 255, 255, 1)
            BorderColor: =RGBA(226, 232, 240, 1)
            BorderThickness: =2
            Visible: =varShowCalendarDetails
          Children:
            - 'Calendar.Details.Header':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: =Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.08
                  Fill: =RGBA(59, 130, 246, 1)
                  BorderColor: =RGBA(37, 99, 235, 1)
                  BorderThickness: =1
                Children:
                  - 'Calendar.Details.Title':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =(Parent.Height - Parent.Height * 0.6) / 2
                        Width: =Parent.Width * 0.8
                        Height: =Parent.Height * 0.6
                        Text: ="Chi tiết lịch nghỉ phép"
                        Color: =RGBA(255, 255, 255, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Bold
                        Size: =FontSizes.Large
                        
                  - 'Calendar.Details.CloseButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =Parent.Width * 0.84
                        Y: =(Parent.Height - Self.Height) / 2
                        Width: =Parent.Width * 0.13
                        Height: =Parent.Height * 0.6
                        Text: ="Đóng"
                        Variant: ="Outline"
                        Size: =FontSizes.Small
                        OnClick: =Set(varShowCalendarDetails, false)
                        
            - 'Calendar.Details.Content':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: ='Calendar.Details.Header'.Y + 'Calendar.Details.Header'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.86
                  BorderColor: =RGBA(226, 232, 240, 1)
                  BorderThickness: =1
                  Fill: =RGBA(255, 255, 255, 1)
                Children:
                  # Leave List Gallery
                  - 'Calendar.Details.LeaveList':
                      Control: Gallery
                      Variant: Vertical
                      Properties:
                        X: =Parent.Width * 0.02
                        Y: =Parent.Height * 0.02
                        Width: =Parent.Width * 0.96
                        Height: =Parent.Height * 0.96
                        Items: =varSelectedDateLeaves
                        TemplateSize: =80
                        BorderThickness: =0
                        Fill: =RGBA(0, 0, 0, 0)
                      Children:
                        - 'Calendar.Details.LeaveItem':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.TemplateWidth
                              Height: =80
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                            Children:
                              # Employee Name
                              - 'Calendar.Details.EmployeeName':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.02
                                    Y: =Parent.Height * 0.1
                                    Width: =Parent.Width * 0.25
                                    Height: =Parent.Height * 0.4
                                    Text: =LookUp(NguoiDung, Title = ThisItem.MaNguoiDung.Value).HoTen
                                    Color: =RGBA(17, 24, 39, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =FontSizes.Base
                                    
                              # Leave Period
                              - 'Calendar.Details.LeavePeriod':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.02
                                    Y: =Parent.Height * 0.55
                                    Width: =Parent.Width * 0.25
                                    Height: =Parent.Height * 0.35
                                    Text: =Text(ThisItem.NgayBatDau, "dd/mm") & " - " & Text(ThisItem.NgayKetThuc, "dd/mm")
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    
                              # Leave Type
                              - 'Calendar.Details.LeaveType':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.3
                                    Y: =Parent.Height * 0.1
                                    Width: =Parent.Width * 0.2
                                    Height: =Parent.Height * 0.4
                                    Text: =LookUp(LoaiNghi, MaLoai = ThisItem.MaLoai.Value).TenLoai
                                    Color: =RGBA(17, 24, 39, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    
                              # Days Count
                              - 'Calendar.Details.DaysCount':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.3
                                    Y: =Parent.Height * 0.55
                                    Width: =Parent.Width * 0.2
                                    Height: =Parent.Height * 0.35
                                    Text: =ThisItem.SoNgayNghi & " ngày"
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    
                              # Status
                              - 'Calendar.Details.Status':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.55
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.2
                                    Height: =Parent.Height * 0.6
                                    Text: =Switch(ThisItem.TrangThai.Value, 
                                      "ChoDuyetCap1", "Chờ duyệt",
                                      "ChoDuyetCap2", "Chờ duyệt", 
                                      "ChoDuyetCap3", "Chờ duyệt",
                                      "DaDuyet", "Đã duyệt",
                                      "TuChoi", "Từ chối",
                                      "Huy", "Đã hủy",
                                      ThisItem.TrangThai.Value)
                                    Color: =Switch(ThisItem.TrangThai.Value,
                                      "DaDuyet", RGBA(34, 197, 94, 1),
                                      "TuChoi", RGBA(239, 68, 68, 1),
                                      "Huy", RGBA(107, 114, 128, 1),
                                      RGBA(251, 191, 36, 1))
                                    Fill: =Switch(ThisItem.TrangThai.Value,
                                      "DaDuyet", RGBA(240, 253, 244, 1),
                                      "TuChoi", RGBA(254, 242, 242, 1),
                                      "Huy", RGBA(249, 250, 251, 1),
                                      RGBA(254, 243, 199, 1))
                                    BorderColor: =Switch(ThisItem.TrangThai.Value,
                                      "DaDuyet", RGBA(34, 197, 94, 1),
                                      "TuChoi", RGBA(239, 68, 68, 1),
                                      "Huy", RGBA(107, 114, 128, 1),
                                      RGBA(251, 191, 36, 1))
                                    BorderThickness: =1
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =FontSizes.Base
                                    Align: =Align.Center
                                    
                              # Reason (partial)
                              - 'Calendar.Details.Reason':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.78
                                    Y: =(Parent.Height - Self.Height) / 2
                                    Width: =Parent.Width * 0.2
                                    Height: =Parent.Height * 0.8
                                    Text: =If(Len(ThisItem.LyDo) > 20, Left(ThisItem.LyDo, 17) & "...", ThisItem.LyDo)
                                    Color: =RGBA(75, 85, 99, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =FontSizes.Base
                                    Wrap: =true 
