Screens:
  ApprovalScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: =Set(varActiveScreen, "Approval"); Set(varPendingRequests, Table({ID: "LR002", EmployeeID: "EMP002", EmployeeName: "Trần Thị Bình", Department: "Phòng Công nghệ thông tin", StartDate: "20/02/2024", EndDate: "22/02/2024", Days: 3, Type: "Nghỉ phép năm", Reason: "Nghỉ việc cá nhân", HandoverPerson: "Nguyễn Văn An", HandoverContent: "Theo dõi tiến độ dự án", CreatedDate: "15/02/2024", CurrentLevel: 1, RequiredLevel: 2, Priority: "Normal"}, {ID: "LR005", EmployeeID: "EMP001", EmployeeName: "Nguyễn Văn An", Department: "Phòng Công nghệ thông tin", StartDate: "25/04/2024", EndDate: "26/04/2024", Days: 2, Type: "Nghỉ phép năm", Reason: "Nghỉ cuối tuần dài", HandoverPerson: "Trần Thị Bình", HandoverContent: "Hoàn thành báo cáo tháng", CreatedDate: "20/04/2024", CurrentLevel: 1, RequiredLevel: 2, Priority: "Normal"}, {ID: "LR006", EmployeeID: "EMP003", EmployeeName: "Lê Văn Cường", Department: "Ban Giám đốc", StartDate: "15/05/2024", EndDate: "20/05/2024", Days: 6, Type: "Nghỉ phép năm", Reason: "Nghỉ phép hè", HandoverPerson: "Phạm Thị Dung", HandoverContent: "Ủy quyền quyết định các vấn đề quan trọng", CreatedDate: "01/05/2024", CurrentLevel: 2, RequiredLevel: 3, Priority: "High"})); Set(varSelectedRequest, Blank()); Set(varApprovalComment, ""); Set(varApprovalAction, ""); Set(varIsProcessing, false)
    Children:
      - 'Approval.Header':
          Control: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =80
            Title: ="Phê duyệt nghỉ phép"
            UserName: =varCurrentUser.FullName
            UserRole: =varCurrentUser.Role
            ShowNotification: =true
            NotificationCount: =CountRows(Filter(varPendingRequests, 
              If(varCurrentUser.Role = "Manager", CurrentLevel = 1, CurrentLevel = 2)))
            
      - 'Approval.Navigation':
          Control: NavigationComponent
          Properties:
            X: =0
            Y: ='Approval.Header'.Y + 'Approval.Header'.Height
            Width: =250
            Height: =Parent.Height - 'Approval.Header'.Height
            UserRole: =varCurrentUser.Role
            ActiveScreen: =varActiveScreen
            OnNavigate: =Set(varNavigateAction, true)
            
      - 'Approval.Content.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Approval.Navigation'.X + 'Approval.Navigation'.Width
            Y: ='Approval.Header'.Y + 'Approval.Header'.Height
            Width: =Parent.Width - 'Approval.Navigation'.Width
            Height: =Parent.Height - 'Approval.Header'.Height
            Fill: =RGBA(248, 250, 252, 1)
          Children:
            - 'Approval.Content.Title':
                Control: Label
                Properties:
                  X: =Parent.X + 30
                  Y: =Parent.Y + 30
                  Width: =Parent.Width - 60
                  Height: =40
                  Text: ="Phê duyệt đơn nghỉ phép - Cấp " & If(varCurrentUser.Role = "Manager", "1", "2")
                  Color: =RGBA(32, 54, 71, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =FontWeight.Bold
                  Size: =24
                  
            - 'Approval.Stats.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.X + 30
                  Y: ='Approval.Content.Title'.Y + 'Approval.Content.Title'.Height + 20
                  Width: =Parent.Width - 60
                  Height: =80
                Children:
                  - 'Approval.Stats.Pending':
                      Control: StatsCardComponent
                      Properties:
                        X: =Parent.X
                        Y: =Parent.Y
                        Width: =(Parent.Width - 40) / 3
                        Height: =Parent.Height
                        Title: ="Chờ phê duyệt"
                        Value: =CountRows(Filter(varPendingRequests, 
                          If(varCurrentUser.Role = "Manager", CurrentLevel = 1, CurrentLevel = 2)))
                        Icon: ="Clock"
                        Color: =RGBA(255, 193, 7, 1)
                        Subtitle: ="Đơn cần xử lý"
                        
                  - 'Approval.Stats.Today':
                      Control: StatsCardComponent
                      Properties:
                        X: ='Approval.Stats.Pending'.X + 'Approval.Stats.Pending'.Width + 20
                        Y: =Parent.Y
                        Width: =(Parent.Width - 40) / 3
                        Height: =Parent.Height
                        Title: ="Hôm nay"
                        Value: =2
                        Icon: ="Calendar"
                        Color: =RGBA(0, 120, 212, 1)
                        Subtitle: ="Đơn được tạo"
                        
                  - 'Approval.Stats.Urgent':
                      Control: StatsCardComponent
                      Properties:
                        X: ='Approval.Stats.Today'.X + 'Approval.Stats.Today'.Width + 20
                        Y: =Parent.Y
                        Width: =(Parent.Width - 40) / 3
                        Height: =Parent.Height
                        Title: ="Ưu tiên cao"
                        Value: =CountRows(Filter(varPendingRequests, Priority = "High"))
                        Icon: ="Cancel"
                        Color: =RGBA(220, 53, 69, 1)
                        Subtitle: ="Cần xử lý gấp"
                        
            - 'Approval.Main.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.X + 30
                  Y: ='Approval.Stats.Container'.Y + 'Approval.Stats.Container'.Height + 20
                  Width: =Parent.Width - 60
                  Height: =Parent.Height - 180
                Children:
                  - 'Approval.List.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =Parent.X
                        Y: =Parent.Y
                        Width: =Parent.Width * 0.6
                        Height: =Parent.Height
                        Fill: =RGBA(255, 255, 255, 1)
                        BorderColor: =RGBA(230, 230, 230, 1)
                        BorderThickness: =1
                        DropShadow: =DropShadow.Light
                      Children:
                        - 'Approval.List.Title':
                            Control: Label
                            Properties:
                              X: =Parent.X + 20
                              Y: =Parent.Y + 20
                              Width: =Parent.Width - 40
                              Height: =30
                              Text: ="Danh sách đơn chờ phê duyệt"
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Approval.List.Gallery':
                            Control: Gallery
                            Variant: Vertical
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.List.Title'.Y + 'Approval.List.Title'.Height + 10
                              Width: =Parent.Width - 40
                              Height: =Parent.Height - 80
                              Items: =Filter(varPendingRequests, 
                                If(varCurrentUser.Role = "Manager", CurrentLevel = 1, CurrentLevel = 2))
                              TemplateSize: =120
                              TemplatePadding: =10
                            Children:
                              - 'Gallery.Request.Container':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.TemplateWidth
                                    Height: =Parent.TemplateHeight
                                    Fill: =If(varSelectedRequest.ID = ThisItem.ID, RGBA(240, 248, 255, 1), RGBA(248, 249, 250, 1))
                                    BorderColor: =If(varSelectedRequest.ID = ThisItem.ID, RGBA(0, 120, 212, 1), RGBA(230, 230, 230, 1))
                                    BorderThickness: =If(varSelectedRequest.ID = ThisItem.ID, 2, 1)
                                    OnSelect: =Set(varSelectedRequest, ThisItem)
                                  Children:
                                    - 'Gallery.Request.Header':
                                        Control: GroupContainer
                                        Variant: ManualLayout
                                        Properties:
                                          X: =Parent.X + 15
                                          Y: =Parent.Y + 10
                                          Width: =Parent.Width - 30
                                          Height: =25
                                        Children:
                                          - 'Gallery.Request.ID':
                                              Control: Label
                                              Properties:
                                                X: =Parent.X
                                                Y: =Parent.Y
                                                Width: =80
                                                Height: =25
                                                Text: =ThisItem.ID
                                                Color: =RGBA(0, 120, 212, 1)
                                                Font: =Font.'Open Sans'
                                                FontWeight: =FontWeight.Bold
                                                Size: =12
                                                
                                          - 'Gallery.Request.Priority':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width - Self.Width
                                                Y: =Parent.Y
                                                Width: =80
                                                Height: =25
                                                Text: =If(ThisItem.Priority = "High", "🔴 Ưu tiên", "⚪ Bình thường")
                                                Color: =If(ThisItem.Priority = "High", RGBA(220, 53, 69, 1), RGBA(108, 117, 125, 1))
                                                Font: =Font.'Open Sans'
                                                FontWeight: =FontWeight.Semibold
                                                Size: =10
                                                Align: =Align.Right
                                                
                                    - 'Gallery.Request.Employee':
                                        Control: Label
                                        Properties:
                                          X: =Parent.X + 15
                                          Y: ='Gallery.Request.Header'.Y + 'Gallery.Request.Header'.Height + 5
                                          Width: =Parent.Width - 30
                                          Height: =20
                                          Text: =ThisItem.EmployeeName & " - " & ThisItem.Department
                                          Color: =RGBA(32, 54, 71, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =12
                                          
                                    - 'Gallery.Request.Period':
                                        Control: Label
                                        Properties:
                                          X: =Parent.X + 15
                                          Y: ='Gallery.Request.Employee'.Y + 'Gallery.Request.Employee'.Height + 2
                                          Width: =Parent.Width - 30
                                          Height: =18
                                          Text: =ThisItem.StartDate & " - " & ThisItem.EndDate & " (" & ThisItem.Days & " ngày)"
                                          Color: =RGBA(108, 117, 125, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =11
                                          
                                    - 'Gallery.Request.Type':
                                        Control: Label
                                        Properties:
                                          X: =Parent.X + 15
                                          Y: ='Gallery.Request.Period'.Y + 'Gallery.Request.Period'.Height + 2
                                          Width: =Parent.Width - 30
                                          Height: =18
                                          Text: =ThisItem.Type & " - " & ThisItem.Reason
                                          Color: =RGBA(108, 117, 125, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =10
                                          
                                    - 'Gallery.Request.CreatedDate':
                                        Control: Label
                                        Properties:
                                          X: =Parent.X + 15
                                          Y: ='Gallery.Request.Type'.Y + 'Gallery.Request.Type'.Height + 5
                                          Width: =Parent.Width - 30
                                          Height: =15
                                          Text: ="Tạo ngày: " & ThisItem.CreatedDate
                                          Color: =RGBA(134, 142, 150, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =9
                                          
                  - 'Approval.Detail.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: ='Approval.List.Container'.X + 'Approval.List.Container'.Width + 20
                        Y: =Parent.Y
                        Width: =Parent.Width - 'Approval.List.Container'.Width - 20
                        Height: =Parent.Height
                        Fill: =RGBA(255, 255, 255, 1)
                        BorderColor: =RGBA(230, 230, 230, 1)
                        BorderThickness: =1
                        DropShadow: =DropShadow.Light
                        Visible: =Not(IsBlank(varSelectedRequest))
                      Children:
                        - 'Approval.Detail.Title':
                            Control: Label
                            Properties:
                              X: =Parent.X + 20
                              Y: =Parent.Y + 20
                              Width: =Parent.Width - 40
                              Height: =30
                              Text: ="Chi tiết đơn nghỉ phép"
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Approval.Detail.Info.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.Detail.Title'.Y + 'Approval.Detail.Title'.Height + 15
                              Width: =Parent.Width - 40
                              Height: =200
                              Fill: =RGBA(248, 249, 250, 1)
                            Children:
                              - 'Approval.Detail.EmployeeInfo':
                                  Control: Label
                                  Properties:
                                    X: =Parent.X + 15
                                    Y: =Parent.Y + 15
                                    Width: =Parent.Width - 30
                                    Height: =60
                                    Text: ="👤 " & varSelectedRequest.EmployeeName & Char(10) & "🏢 " & varSelectedRequest.Department & Char(10) & "📧 " & varSelectedRequest.EmployeeID
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =12
                                    
                              - 'Approval.Detail.LeaveInfo':
                                  Control: Label
                                  Properties:
                                    X: =Parent.X + 15
                                    Y: ='Approval.Detail.EmployeeInfo'.Y + 'Approval.Detail.EmployeeInfo'.Height + 10
                                    Width: =Parent.Width - 30
                                    Height: =80
                                    Text: ="📅 Thời gian: " & varSelectedRequest.StartDate & " - " & varSelectedRequest.EndDate & Char(10) & "⏰ Số ngày: " & varSelectedRequest.Days & " ngày" & Char(10) & "📝 Loại: " & varSelectedRequest.Type & Char(10) & "💬 Lý do: " & varSelectedRequest.Reason
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =12
                                    
                              - 'Approval.Detail.HandoverInfo':
                                  Control: Label
                                  Properties:
                                    X: =Parent.X + 15
                                    Y: ='Approval.Detail.LeaveInfo'.Y + 'Approval.Detail.LeaveInfo'.Height + 10
                                    Width: =Parent.Width - 30
                                    Height: =40
                                    Text: ="🤝 Người bàn giao: " & varSelectedRequest.HandoverPerson & Char(10) & "📋 Nội dung: " & varSelectedRequest.HandoverContent
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =12
                                    
                        - 'Approval.Detail.Comment.Label':
                            Control: Label
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.Detail.Info.Container'.Y + 'Approval.Detail.Info.Container'.Height + 20
                              Width: =Parent.Width - 40
                              Height: =25
                              Text: ="Ý kiến phê duyệt:"
                              Color: =RGBA(32, 54, 71, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Semibold
                              Size: =14
                              
                        - 'Approval.Detail.Comment.Input':
                            Control: Classic/TextInput
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.Detail.Comment.Label'.Y + 'Approval.Detail.Comment.Label'.Height + 5
                              Width: =Parent.Width - 40
                              Height: =80
                              HintText: ="Nhập ý kiến phê duyệt..."
                              Mode: =TextMode.MultiLine
                              BorderColor: =RGBA(230, 230, 230, 1)
                              Font: =Font.'Open Sans'
                              Size: =12
                              PaddingLeft: =15
                              PaddingTop: =15
                              OnChange: =Set(varApprovalComment, Self.Text)
                              
                        - 'Approval.Detail.Actions.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.Detail.Comment.Input'.Y + 'Approval.Detail.Comment.Input'.Height + 20
                              Width: =Parent.Width - 40
                              Height: =60
                            Children:
                              - 'Approval.Detail.Approve.Button':
                                  Control: Classic/Button
                                  Properties:
                                    X: =Parent.X
                                    Y: =Parent.Y
                                    Width: =(Parent.Width - 20) / 2
                                    Height: =50
                                    Text: =If(varIsProcessing And varApprovalAction = "Approve", "Đang xử lý...", "✅ Phê duyệt")
                                    Fill: =RGBA(40, 167, 69, 1)
                                    Color: =RGBA(255, 255, 255, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =14
                                    DisplayMode: =If(varIsProcessing, DisplayMode.Disabled, DisplayMode.Edit)
                                    OnSelect: =Set(varIsProcessing, true); Set(varApprovalAction, "Approve"); If(Not(IsBlank(varSelectedRequest)), Notify("Đơn " & varSelectedRequest.ID & " đã được phê duyệt!", NotificationType.Success); Set(varPendingRequests, Filter(varPendingRequests, ID <> varSelectedRequest.ID)); Set(varSelectedRequest, Blank()); Set(varApprovalComment, ""); Set(varIsProcessing, false), Notify("Vui lòng chọn đơn cần phê duyệt!", NotificationType.Error); Set(varIsProcessing, false))
                                      
                              - 'Approval.Detail.Reject.Button':
                                  Control: Classic/Button
                                  Properties:
                                    X: ='Approval.Detail.Approve.Button'.X + 'Approval.Detail.Approve.Button'.Width + 20
                                    Y: =Parent.Y
                                    Width: =(Parent.Width - 20) / 2
                                    Height: =50
                                    Text: =If(varIsProcessing And varApprovalAction = "Reject", "Đang xử lý...", "❌ Từ chối")
                                    Fill: =RGBA(220, 53, 69, 1)
                                    Color: =RGBA(255, 255, 255, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =14
                                    DisplayMode: =If(varIsProcessing, DisplayMode.Disabled, DisplayMode.Edit)
                                    OnSelect: =Set(varIsProcessing, true); Set(varApprovalAction, "Reject"); If(And(Not(IsBlank(varSelectedRequest)), Not(IsBlank(varApprovalComment))), Notify("Đơn " & varSelectedRequest.ID & " đã bị từ chối!", NotificationType.Warning); Set(varPendingRequests, Filter(varPendingRequests, ID <> varSelectedRequest.ID)); Set(varSelectedRequest, Blank()); Set(varApprovalComment, ""); Set(varIsProcessing, false), If(IsBlank(varSelectedRequest), Notify("Vui lòng chọn đơn cần phê duyệt!", NotificationType.Error), Notify("Vui lòng nhập lý do từ chối!", NotificationType.Error)); Set(varIsProcessing, false))
                                      
                        - 'Approval.Detail.Workflow.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.X + 20
                              Y: ='Approval.Detail.Actions.Container'.Y + 'Approval.Detail.Actions.Container'.Height + 20
                              Width: =Parent.Width - 40
                              Height: =80
                              Fill: =RGBA(240, 248, 255, 1)
                            Children:
                              - 'Approval.Detail.Workflow.Title':
                                  Control: Label
                                  Properties:
                                    X: =Parent.X + 15
                                    Y: =Parent.Y + 10
                                    Width: =Parent.Width - 30
                                    Height: =20
                                    Text: ="Quy trình phê duyệt:"
                                    Color: =RGBA(32, 54, 71, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =12
                                    
                              - 'Approval.Detail.Workflow.Steps':
                                  Control: Label
                                  Properties:
                                    X: =Parent.X + 15
                                    Y: ='Approval.Detail.Workflow.Title'.Y + 'Approval.Detail.Workflow.Title'.Height + 5
                                    Width: =Parent.Width - 30
                                    Height: =40
                                    Text: =If(varSelectedRequest.Days <= 12, 
                                      "≤12 ngày: Manager ➜ Director (2 cấp)" & Char(10) & "Hiện tại: Cấp " & varSelectedRequest.CurrentLevel & " / 2",
                                      ">12 ngày: Manager ➜ Director ➜ Giám đốc điều hành (3 cấp)" & Char(10) & "Hiện tại: Cấp " & varSelectedRequest.CurrentLevel & " / 3"
                                    )
                                    Color: =RGBA(0, 120, 212, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =10
                                    
                  - 'Approval.NoSelection.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: ='Approval.List.Container'.X + 'Approval.List.Container'.Width + 20
                        Y: =Parent.Y
                        Width: =Parent.Width - 'Approval.List.Container'.Width - 20
                        Height: =Parent.Height
                        Fill: =RGBA(255, 255, 255, 1)
                        BorderColor: =RGBA(230, 230, 230, 1)
                        BorderThickness: =1
                        DropShadow: =DropShadow.Light
                        Visible: =IsBlank(varSelectedRequest)
                      Children:
                        - 'Approval.NoSelection.Message':
                            Control: Label
                            Properties:
                              X: =Parent.X + 20
                              Y: =Parent.Y + (Parent.Height / 2) - 50
                              Width: =Parent.Width - 40
                              Height: =100
                              Text: ="📋 Chọn đơn nghỉ phép" & Char(10) & Char(10) & "Vui lòng chọn một đơn nghỉ phép từ danh sách bên trái để xem chi tiết và thực hiện phê duyệt."
                              Color: =RGBA(108, 117, 125, 1)
                              Font: =Font.'Open Sans'
                              Size: =14
                              Align: =Align.Center 