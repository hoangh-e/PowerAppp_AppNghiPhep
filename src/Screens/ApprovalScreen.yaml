Screens:
  ApprovalScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =Set(varActiveScreen, "Approval"); 
        Set(varSelectedApprovalLeave, Blank());
        Set(varShowApprovalDetails, false);
        Set(varShowApprovalConfirm, false);
        Set(varApprovalAction, "");
          Set(varApprovalComment, ""); 
        Set(varPendingApprovals, Filter(DonNghiPhep, Or(TrangThai.Value = "ChoDuyetCap1", TrangThai.Value = "ChoDuyetCap2", TrangThai.Value = "ChoDuyetCap3")));
        Set(varMyLevelApprovals, Filter(varPendingApprovals, 
          Switch(UserSession.MaVaiTro,
            "Manager", TrangThai.Value = "ChoDuyetCap1",
            "Director", Or(TrangThai.Value = "ChoDuyetCap2", And(TrangThai.Value = "ChoDuyetCap3", CountRows(Filter(DonNghiPhep, And(MaDon = ThisItem.MaDon, SoNgayNghi > 12))) > 0)),
            "HR", TrangThai.Value = "ChoDuyetCap3",
            false)))
    Children:
      # Header Component
      - 'Approval.Header':
          Control: CanvasComponent
          ComponentName: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =Parent.Height * 0.065
            UserName: =UserSession.HoTen
            UserRole: =UserSession.MaVaiTro
            ShowNotification: =true
            NotificationCount: =CountRows(varMyLevelApprovals)
            OnLogout: |
              =Set(varIsUserAuthenticated, false);
              Set(UserSession, {
                Id: "", 
                Name: "", 
                Email: "", 
                Role: "", 
                Permission: 0,
                NguoiQuanLyId: "", 
                HoTen: "", 
                MaVaiTro: "", 
                ChucDanh: "", 
                MaDonVi: "", 
                TrangThai: ""
              });
              Navigate(LoginScreen)
            
      # Navigation Component
      - 'Approval.Navigation':
          Control: CanvasComponent
          ComponentName: NavigationComponent
          Properties:
            X: =0
            Y: ='Approval.Header'.Height
            Width: =If(varNavCollapsed, App.Width * 0.045, App.Width * 0.14)
            Height: =Parent.Height - 'Approval.Header'.Height
            UserRole: =UserSession.MaVaiTro
            ActiveScreen: ="Approval"
            IsCollapsed: =varNavCollapsed
            DashboardScreen: =DashboardScreen
            LeaveRequestScreen: =LeaveRequestScreen
            MyLeavesScreen: =MyLeavesScreen
            CalendarScreen: =CalendarScreen
            ManagementScreen: =ManagementScreen
            ProfileScreen: =ProfileScreen
            OnNavigate: |
              =Set(varActiveScreen, ScreenName);
              Switch(ScreenName,
                "Dashboard", Navigate(DashboardScreen),
                "LeaveRequest", Navigate(LeaveRequestScreen),
                "MyLeaves", Navigate(MyLeavesScreen),
                "Calendar", Navigate(CalendarScreen),
                "Management", Navigate(ManagementScreen),
                "Profile", Navigate(ProfileScreen),
                "Approval", Navigate(ApprovalScreen),
                "Reports", Navigate(ReportsScreen)
              )
            OnToggleCollapse: |
              =Set(varNavCollapsed, !varNavCollapsed)
            
      # Main Content Container
      - 'Approval.Content.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Approval.Navigation'.Width
            Y: ='Approval.Header'.Height
            Width: =Parent.Width - 'Approval.Navigation'.Width
            Height: =Parent.Height - 'Approval.Header'.Height
          Children:
            - 'Approval.Content.Padded':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.01
                  Y: =Parent.Height * 0.01
                  Width: =Parent.Width * 0.98
                  Height: =Parent.Height * 0.98
                Children:
                  # Page Header
                  - 'Approval.PageHeader.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.1
                      Children:
                        - 'Approval.PageHeader.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        - 'Approval.PageHeader.Icon':
                            Control: Classic/Icon
                            Properties:
                              X: =Parent.Width * 0.015
                              Y: =Parent.Height * 0.25
                              Width: =Parent.Height * 0.2
                              Height: =Parent.Height * 0.2
                              Icon: =Icon.CheckBadge
                              Color: =RGBA(59, 130, 246, 1)
                              
                        - 'Approval.PageHeader.Title':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.015 + 'Approval.PageHeader.Icon'.Width + Parent.Width * 0.01
                              Y: =Parent.Height * 0.2
                              Width: =Parent.Width * 0.6
                              Height: =Parent.Height * 0.35
                              Text: ="Phê duyệt đơn nghỉ phép"
                              Color: =RGBA(17, 24, 39, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =14
                              
                        - 'Approval.PageHeader.Stats':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.015 + 'Approval.PageHeader.Icon'.Width + Parent.Width * 0.01
                              Y: =Parent.Height * 0.6
                              Width: =Parent.Width * 0.6
                              Height: =Parent.Height * 0.25
                              Text: =Concatenate("Đang chờ duyệt" & ":" & " ", CountRows(varMyLevelApprovals), " " & "đơn")
                              Color: =RGBA(75, 85, 99, 1)
                              Font: =Font.'Open Sans'
                              Size: =11

                  # Stats Section
                  - 'Approval.Stats.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                            Properties:
                        X: =0
                        Y: ='Approval.PageHeader.Container'.Y + 'Approval.PageHeader.Container'.Height + Parent.Height * 0.015
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.15
                      Children:
                        - 'Approval.Stats.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        - 'Approval.Stats.Header':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.015
                              Y: =Parent.Height * 0.05
                              Width: =Parent.Width * 0.97
                              Height: =Parent.Height * 0.2
                              Text: ="Tổng quan phê duyệt"
                              Color: =RGBA(17, 24, 39, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =12
                        
                        - 'Approval.Stats.Cards.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.015
                              Y: =Parent.Height * 0.3
                              Width: =Parent.Width * 0.97
                              Height: =Parent.Height * 0.65
                            Children:
                              - 'Approval.Stats.Pending':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                        Properties:
                                          X: =0
                                          Y: =0
                                    Width: =(Parent.Width - Parent.Width * 0.03) / 4
                                    Height: =Parent.Height
                                    Title: ="Chờ tôi duyệt"
                                    Value: =CountRows(varMyLevelApprovals)
                                    Icon: ="Clock"
                                    Color: =RGBA(251, 191, 36, 1)
                                    ShowTrend: =false
                                    
                              - 'Approval.Stats.Cap1':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =(Parent.Width + Parent.Width * 0.01) / 4
                                    Y: =0
                                    Width: =(Parent.Width - Parent.Width * 0.03) / 4
                                    Height: =Parent.Height
                                    Title: ="Chờ cấp 1"
                                    Value: =CountRows(Filter(varPendingApprovals, TrangThai.Value = "ChoDuyetCap1"))
                                    Icon: ="Person"
                                    Color: =RGBA(239, 68, 68, 1)
                                    ShowTrend: =false
                                    
                              - 'Approval.Stats.Cap2':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =(Parent.Width + Parent.Width * 0.01) * 2 / 4
                                    Y: =0
                                    Width: =(Parent.Width - Parent.Width * 0.03) / 4
                                    Height: =Parent.Height
                                    Title: ="Chờ cấp 2"
                                    Value: =CountRows(Filter(varPendingApprovals, TrangThai.Value = "ChoDuyetCap2"))
                                    Icon: ="Settings"
                                    Color: =RGBA(251, 146, 60, 1)
                                    ShowTrend: =false

                              - 'Approval.Stats.Cap3':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =(Parent.Width + Parent.Width * 0.01) * 3 / 4
                                    Y: =0
                                    Width: =(Parent.Width - Parent.Width * 0.03) / 4
                                    Height: =Parent.Height
                                    Title: ="Chờ cấp 3"
                                    Value: =CountRows(Filter(varPendingApprovals, TrangThai.Value = "ChoDuyetCap3"))
                                    Icon: ="Crown"
                                    Color: =RGBA(139, 69, 19, 1)
                                    ShowTrend: =false

      # DataTable for Approvals - Direct Screen child
      - 'Approval.DataTable':
          Control: DataTable@1.0.3
          Variant: DataTable
          Properties:
            X: ='Approval.Navigation'.Width + 'Approval.Content.Container'.Width * 0.02
            Y: ='Approval.Header'.Height + 'Approval.Content.Container'.Height * 0.32
            Width: ='Approval.Content.Container'.Width * 0.96
            Height: ='Approval.Content.Container'.Height * 0.65
            Items: =SortByColumns(varMyLevelApprovals, "NgayBatDau", SortOrder.Ascending)
            BorderColor: =RGBA(229, 231, 235, 1)
            BorderThickness: =1
            Font: =Font.'Open Sans'
            Size: =11
            Color: =RGBA(55, 65, 81, 1)
            HeadingColor: =RGBA(255, 255, 255, 1)
            HeadingFill: =RGBA(59, 130, 246, 1)
            HeadingFont: =Font.'Open Sans'
            HeadingFontWeight: =FontWeight.Bold
            HeadingSize: =12
            NoDataText: ="Không có đơn cần phê duyệt"
                                  Children:
            - NguoiTao_Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Người tạo"
                  FieldName: ="MaNguoiDung"
                  Order: =1
                  Text: =LookUp(NguoiDung, Title = ThisItem.MaNguoiDung.Value).HoTen
                  OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            - NgayBatDau_Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                                        Properties:
                  FieldDisplayName: ="Ngày bắt đầu"
                  FieldName: ="NgayBatDau"
                  Order: =2
                  Text: =Text(ThisItem.NgayBatDau, "dd/mm/yyyy")
                  OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            - NgayKetThuc_Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                                        Properties:
                  FieldDisplayName: ="Ngày kết thúc"
                  FieldName: ="NgayKetThuc"
                  Order: =3
                  Text: =Text(ThisItem.NgayKetThuc, "dd/mm/yyyy")
                  OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            - SoNgayNghi_Column:
                Control: DataTableColumn@1.0.1
                Variant: Number
                                        Properties:
                  FieldDisplayName: ="Số ngày"
                  FieldName: ="SoNgayNghi"
                  Order: =4
                  Text: =Text(ThisItem.SoNgayNghi) & " ngày"
                  OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            - LoaiNghi_Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                                        Properties:
                  FieldDisplayName: ="Loại nghỉ"
                  FieldName: ="MaLoai"
                  Order: =5
                  Text: =LookUp(LoaiNghi, MaLoai = ThisItem.MaLoai.Value).TenLoai
                  OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            - TrangThai_Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
          Properties:
                  FieldDisplayName: ="Trạng thái"
                  FieldName: ="TrangThai"
                  Order: =6
                  Text: =Switch(ThisItem.TrangThai.Value, "ChoDuyetCap1", "Chờ duyệt cấp 1", "ChoDuyetCap2", "Chờ duyệt cấp 2", "ChoDuyetCap3", "Chờ duyệt cấp 3", "Không xác định")
            OnSelect: |
                    =Set(varSelectedApprovalLeave, Parent.Selected);
                    Set(varShowApprovalDetails, true)
            
      # Approval Details Modal
      - 'Approval.Details.Modal':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: =(Parent.Width - Parent.Width * 0.8) / 2
            Y: =(Parent.Height - Parent.Height * 0.9) / 2
            Width: =Parent.Width * 0.8
            Height: =Parent.Height * 0.9
            Fill: =RGBA(255, 255, 255, 1)
            BorderColor: =RGBA(226, 232, 240, 1)
            BorderThickness: =2
            Visible: =varShowApprovalDetails
          Children:
            - 'Approval.Details.Header':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: =Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.08
                  Fill: =RGBA(59, 130, 246, 1)
                  BorderColor: =RGBA(37, 99, 235, 1)
                  BorderThickness: =1
                Children:
                  - 'Approval.Details.Title':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =(Parent.Height - Parent.Height * 0.6) / 2
                        Width: =Parent.Width * 0.8
                        Height: =Parent.Height * 0.6
                        Text: ="Chi tiết đơn nghỉ phép - Phê duyệt"
                        Color: =RGBA(255, 255, 255, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Bold
                        Size: =Parent.Height * 0.25
                        
                  - 'Approval.Details.CloseButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =Parent.Width * 0.84
                        Y: =(Parent.Height - Self.Height) / 2
                        Width: =Parent.Width * 0.13
                        Height: =Parent.Height * 0.6
                        Text: ="Đóng"
                        Variant: ="Outline"
                        Size: ="Small"
                        OnClick: |
                          =Set(varShowApprovalDetails, false)
                        
            - 'Approval.Details.Content':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: ='Approval.Details.Header'.Y + 'Approval.Details.Header'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.65
                  BorderColor: =RGBA(226, 232, 240, 1)
                  BorderThickness: =1
                  Fill: =RGBA(255, 255, 255, 1)
                Children:
                  # Employee Info
                  - 'Approval.Details.Employee.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.05
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.06
                        Text: ="Nhân viên:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Details.Employee.Value':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.05
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.06
                        Text: =If(Not(IsBlank(varSelectedApprovalLeave)), LookUp(NguoiDung, Title = varSelectedApprovalLeave.MaNguoiDung.Value).HoTen & " (" & LookUp(NguoiDung, Title = varSelectedApprovalLeave.MaNguoiDung.Value).Email & ")", "")
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =12
                        
                  # Leave Period
                  - 'Approval.Details.Period.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.15
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.06
                        Text: ="Thời gian nghỉ:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Details.Period.Value':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.15
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.06
                        Text: =If(Not(IsBlank(varSelectedApprovalLeave)), Text(varSelectedApprovalLeave.NgayBatDau, "dd/mm/yyyy") & " - " & Text(varSelectedApprovalLeave.NgayKetThuc, "dd/mm/yyyy") & " (" & varSelectedApprovalLeave.SoNgayNghi & " ngày)", "")
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =12
                        
                  # Leave Type
                  - 'Approval.Details.Type.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.25
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.06
                        Text: ="Loại nghỉ:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Details.Type.Value':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.25
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.06
                        Text: =If(Not(IsBlank(varSelectedApprovalLeave)), LookUp(LoaiNghi, MaLoai = varSelectedApprovalLeave.MaLoai.Value).TenLoai, "")
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =12
                        
                  # Reason
                  - 'Approval.Details.Reason.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.35
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.06
                        Text: ="Lý do:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Details.Reason.Value':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.35
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.15
                        Text: =If(Not(IsBlank(varSelectedApprovalLeave)), varSelectedApprovalLeave.LyDo, "")
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =12
                        Wrap: =true
                        
                  # Handover
                  - 'Approval.Details.Handover.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.55
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.06
                        Text: ="Bàn giao công việc:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Details.Handover.Value':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.55
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.15
                        Text: =If(Not(IsBlank(varSelectedApprovalLeave)), If(Not(IsBlank(varSelectedApprovalLeave.NguoiBanGiao)), LookUp(NguoiDung, Title = varSelectedApprovalLeave.NguoiBanGiao.Value).HoTen & " - " & varSelectedApprovalLeave.NoiDungBanGiao, "Không có"), "")
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =12
                        Wrap: =true
                        
            - 'Approval.Details.Actions':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: ='Approval.Details.Content'.Y + 'Approval.Details.Content'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.2
                Children:
                  # Comment Input
                  - 'Approval.Comment.Label':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.05
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.25
                        Text: ="Ghi chú phê duyệt:"
                        Color: =RGBA(17, 24, 39, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =12
                        
                  - 'Approval.Comment.Input':
                      Control: Classic/TextInput
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.05
                        Width: =Parent.Width * 0.7
                        Height: =Parent.Height * 0.25
                        HintText: ="Nhập ghi chú (tùy chọn)"
                        Color: =RGBA(55, 65, 81, 1)
                        Fill: =RGBA(255, 255, 255, 1)
                        BorderColor: =RGBA(224, 224, 224, 1)
                        BorderThickness: =1
                        Font: =Font.'Open Sans'
                        Size: =12
                        OnChange: |
                          =Set(varApprovalComment, Self.Text)
                        
            # Action Buttons
                  - 'Approval.ApproveButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =Parent.Width * 0.25
                        Y: =Parent.Height * 0.45
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.4
                        Text: ="Phê duyệt"
                        Variant: ="Primary"
                        Size: ="Medium"
                        OnClick: |
                          =Set(varApprovalAction, "Approve");
                          Set(varShowApprovalConfirm, true)
                        
                  - 'Approval.RejectButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =Parent.Width * 0.5
                        Y: =Parent.Height * 0.45
                        Width: =Parent.Width * 0.2
                        Height: =Parent.Height * 0.4
                        Text: ="Từ chối"
                        Variant: ="Danger"
                        Size: ="Medium"
                        OnClick: |
                          =Set(varApprovalAction, "Reject");
                          Set(varShowApprovalConfirm, true)

      # Approval Confirmation Modal
      - 'Approval.Confirm.Modal':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: =(Parent.Width - Parent.Width * 0.4) / 2
            Y: =(Parent.Height - Parent.Height * 0.3) / 2
            Width: =Parent.Width * 0.4
            Height: =Parent.Height * 0.3
            Fill: =RGBA(255, 255, 255, 1)
            BorderColor: =RGBA(226, 232, 240, 1)
            BorderThickness: =2
            Visible: =varShowApprovalConfirm
          Children:
            - 'Approval.Confirm.Header':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.04
                  Y: =Parent.Height * 0.04
                  Width: =Parent.Width * 0.92
                  Height: =Parent.Height * 0.15
                  Fill: =If(varApprovalAction = "Approve", RGBA(34, 197, 94, 1), RGBA(239, 68, 68, 1))
                  BorderColor: =If(varApprovalAction = "Approve", RGBA(21, 128, 61, 1), RGBA(220, 38, 38, 1))
                  BorderThickness: =1
                Children:
                  - 'Approval.Confirm.Title':
                      Control: Label
                      Properties:
                        X: =Parent.Width * 0.05
                        Y: =(Parent.Height - Parent.Height * 0.7) / 2
                        Width: =Parent.Width * 0.9
                        Height: =Parent.Height * 0.7
                        Text: =If(varApprovalAction = "Approve", "Xác nhận phê duyệt", "Xác nhận từ chối")
                        Color: =RGBA(255, 255, 255, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Bold
                        Size: =Parent.Height * 0.35
                        Align: =Align.Center
                  
            - 'Approval.Confirm.Content':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.04
                  Y: ='Approval.Confirm.Header'.Y + 'Approval.Confirm.Header'.Height + Parent.Height * 0.03
                  Width: =Parent.Width * 0.92
                  Height: =Parent.Height * 0.4
                Children:
                  - 'Approval.Confirm.Message':
                      Control: Label
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height
                        Text: =If(varApprovalAction = "Approve", 
                          Concatenate("Bạn có chắc chắn muốn phê duyệt đơn nghỉ phép từ ngày ", If(Not(IsBlank(varSelectedApprovalLeave)), Text(varSelectedApprovalLeave.NgayBatDau, "dd/mm/yyyy"), ""), " đến ", If(Not(IsBlank(varSelectedApprovalLeave)), Text(varSelectedApprovalLeave.NgayKetThuc, "dd/mm/yyyy"), ""), "?"),
                          Concatenate("Bạn có chắc chắn muốn từ chối đơn nghỉ phép từ ngày ", If(Not(IsBlank(varSelectedApprovalLeave)), Text(varSelectedApprovalLeave.NgayBatDau, "dd/mm/yyyy"), ""), " đến ", If(Not(IsBlank(varSelectedApprovalLeave)), Text(varSelectedApprovalLeave.NgayKetThuc, "dd/mm/yyyy"), ""), "?"))
                        Color: =RGBA(55, 65, 81, 1)
                        Font: =Font.'Open Sans'
                        Size: =Parent.Height * 0.15
                        Align: =Align.Center
                        Wrap: =true
                  
            - 'Approval.Confirm.Actions':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.04
                  Y: ='Approval.Confirm.Content'.Y + 'Approval.Confirm.Content'.Height + Parent.Height * 0.03
                  Width: =Parent.Width * 0.92
                  Height: =Parent.Height * 0.25
                Children:
                  - 'Approval.Confirm.CancelButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =0
                        Y: =(Parent.Height - Self.Height) / 2
                        Width: =Parent.Width * 0.45
                        Height: =Parent.Height * 0.8
                        Text: ="Hủy"
                        Variant: ="Outline"
                        Size: ="Medium"
                        OnClick: |
                          =Set(varShowApprovalConfirm, false);
                          Set(varApprovalAction, "")
                        
                  - 'Approval.Confirm.ConfirmButton':
                      Control: CanvasComponent
                      ComponentName: ButtonComponent
                      Properties:
                        X: =Parent.Width * 0.55
                        Y: =(Parent.Height - Self.Height) / 2
                        Width: =Parent.Width * 0.45
                        Height: =Parent.Height * 0.8
                        Text: =If(varApprovalAction = "Approve", "Phê duyệt", "Từ chối")
                        Variant: =If(varApprovalAction = "Approve", "Primary", "Danger")
                        Size: ="Medium"
                        OnClick: |
                          =If(Not(IsBlank(varSelectedApprovalLeave)),
                            If(varApprovalAction = "Approve",
                              /* Phê duyệt logic */
                              With(varSelectedApprovalLeave.TrangThai.Value,
                                Switch(ThisRecord,
                                  "ChoDuyetCap1", 
                                    If(varSelectedApprovalLeave.SoNgayNghi <= 12,
                                      Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "DaDuyet"}}),
                                      Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "ChoDuyetCap2"}})),
                                  "ChoDuyetCap2",
                                    If(varSelectedApprovalLeave.SoNgayNghi <= 12,
                                      Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "DaDuyet"}}),
                                      Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "ChoDuyetCap3"}})),
                                  "ChoDuyetCap3",
                                    Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "DaDuyet"}})
                                ));
                              Notify("Đã phê duyệt đơn nghỉ phép", NotificationType.Success),
                              /* Từ chối logic */
                              Patch(DonNghiPhep, varSelectedApprovalLeave, {TrangThai: {Value: "TuChoi"}});
                              Notify("Đã từ chối đơn nghỉ phép", NotificationType.Information)
                            );
                            Set(varShowApprovalConfirm, false);
                            Set(varShowApprovalDetails, false);
                            Set(varApprovalAction, "");
                            Set(varSelectedApprovalLeave, Blank());
                            /* Refresh data */
                            Set(varPendingApprovals, Filter(DonNghiPhep, Or(TrangThai.Value = "ChoDuyetCap1", TrangThai.Value = "ChoDuyetCap2", TrangThai.Value = "ChoDuyetCap3")));
                            Set(varMyLevelApprovals, Filter(varPendingApprovals, 
                              Switch(UserSession.MaVaiTro,
                                "Manager", TrangThai.Value = "ChoDuyetCap1",
                                "Director", Or(TrangThai.Value = "ChoDuyetCap2", And(TrangThai.Value = "ChoDuyetCap3", CountRows(Filter(DonNghiPhep, And(MaDon = ThisItem.MaDon, SoNgayNghi > 12))) > 0)),
                                "HR", TrangThai.Value = "ChoDuyetCap3",
                                false))),
                            Notify("Có lỗi xảy ra", NotificationType.Error)
                          ) 
