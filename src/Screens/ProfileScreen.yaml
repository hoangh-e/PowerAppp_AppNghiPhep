Screens:
  ProfileScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =//Set active screen first to ensure NavigationComponent receives correct value
        Set(varActiveScreen, "Profile");
        If(Not(varIsUserAuthenticated), 
          Navigate(LoginScreen), 
          If(Not(varIsUserAuthenticated) Or IsBlank(User),
            Navigate(LoginScreen),
            //Continue with screen initialization
            Set(varNavCollapsed, false);
            Set(varMobileMenuOpen, false);
            Set(varCurrentUser, User);
            Set(varEditMode, false);
            Set(varIsSaving, false);
            Set(varSaveSuccess, false);
            Set(varUserDepartment, {
              TenDonVi: "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin",
              MaDonVi: "IT"
            }); 
            Set(varUserRole, {
              TenVaiTro: If(User.MaVaiTro = "ADMIN", "Qu·∫£n tr·ªã vi√™n", If(User.MaVaiTro = "Manager", "Tr∆∞·ªüng ph√≤ng", "Nh√¢n vi√™n")),
              MaVaiTro: User.MaVaiTro
            }); 
            Set(varUserLeaveBalance, {
              TongNgayDuocPhep: 12,
              SoNgayDaNghi: 3,
              SoNgayConLai: 9,
              Nam: Year(Today())
            }); 
            Set(varUserLeaveHistory, Table(
              {
                ID: "REQ001",
                NgayBatDau: DateAdd(Today(), -30),
                NgayKetThuc: DateAdd(Today(), -28),
                SoNgayNghi: 3,
                TrangThai: "DaDuyet",
                MaLoai: "Annual"
              },
              {
                ID: "REQ002", 
                NgayBatDau: DateAdd(Today(), -15),
                NgayKetThuc: DateAdd(Today(), -13),
                SoNgayNghi: 3,
                TrangThai: "ChoDuyetCap1",
                MaLoai: "Sick"
              }
            )); 
            Set(varProfileErrors, {})
          )
        )
    Children:
      - 'Profile.Header':
          Control: CanvasComponent
          ComponentName: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =Parent.Height * 0.065
            UserName: =If(IsBlank(User.HoTen), "ƒêang t·∫£i...", User.HoTen)
            UserRole: =If(IsBlank(User.MaVaiTro), "User", User.MaVaiTro)
            ShowNotification: =true
            NotificationCount: =CountRows(Filter(varUserLeaveHistory, TrangThai in ["ChoDuyetCap1", "ChoDuyetCap2", "ChoDuyetCap3"]))
            OnLogout: |
              =//Clear all session variables first
              Set(varLoginSuccess, false);
              Set(varSessionValid, false);
              Set(varLoggedInUserEmail, "");
              Set(varIsUserAuthenticated, false);
              //Clear user session object
              Set(UserSession, {
                Id: "", Name: "", Email: "", Role: "", Permission: 0,
                NguoiQuanLyId: "", HoTen: "", MaVaiTro: "", 
                ChucDanh: "", MaDonVi: "", TrangThai: ""
              });
              //Clear current user and profile data
              Set(varCurrentUser, Blank());
              Set(User, Blank());
              Set(varUserLeaveBalance, {});
              Set(varUserLeaveHistory, Table());
              //Set logout flags
              Set(varLocalLoggedOut, true);
              Set(varLocalSessionCleared, true);
              //Navigate to login screen
              Navigate(LoginScreen)
            
      - 'Profile.Navigation':
          Control: CanvasComponent
          ComponentName: NavigationComponent
          Properties:
            X: =0
            Y: ='Profile.Header'.Height
            Width: =If(varNavCollapsed, App.Width * 0.06, App.Width * 0.2)
            Height: =Parent.Height - 'Profile.Header'.Height
            UserRole: =If(IsBlank(User.MaVaiTro), "Employee", User.MaVaiTro)
            ActiveScreen: =If(IsBlank(varActiveScreen), "Profile", varActiveScreen)
            IsCollapsed: =varNavCollapsed
            OnNavigate: |
              =Set(varActiveScreen, ScreenName);
              Switch(ScreenName,
                "Dashboard", Navigate(DashboardScreen),
                "Profile", Navigate(ProfileScreen),
                "LeaveRequest", Navigate(LeaveRequestScreen),
                "MyLeaves", Navigate(MyLeavesScreen),
                "Calendar", Navigate(CalendarScreen),
                "Management", Navigate(ManagementScreen),
                "Approval", Navigate(ApprovalScreen),
                "Reports", Navigate(ReportsScreen)
              )
            OnToggleCollapse: |
              =Set(varNavCollapsed, !varNavCollapsed)
            
      - 'Profile.Content.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Profile.Navigation'.Width
            Y: ='Profile.Header'.Height
            Width: =Parent.Width - 'Profile.Navigation'.Width
            Height: =Parent.Height - 'Profile.Header'.Height
          Children:
            # Content Padding Container
            - 'Profile.Content.Padded':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.02
                  Y: =Parent.Height * 0.02
                  Width: =Parent.Width * 0.96
                  Height: =Parent.Height * 0.96
                Children:
                  # Profile Header Card
                  - 'Profile.Info.Header':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.25
                      Children:
                        - 'Profile.Info.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(224, 224, 224, 1)
                              BorderThickness: =1
                              
                        # Avatar Section
                        - 'Profile.Avatar.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.04
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.25
                              Height: =Parent.Height * 0.8
                            Children:
                              - 'Profile.Avatar.Circle':
                                  Control: Circle
                                  Properties:
                                    X: =(Parent.Width - Self.Width) / 2
                                    Y: =0
                                    Width: =Parent.Height * 0.7
                                    Height: =Parent.Height * 0.7
                                    Fill: =RGBA(33, 150, 243, 0.1)
                                    BorderColor: =RGBA(33, 150, 243, 1)
                                    BorderThickness: =2
                                    
                              - 'Profile.Avatar.Initial':
                                  Control: Label
                                  Properties:
                                    X: ='Profile.Avatar.Circle'.X + ('Profile.Avatar.Circle'.Width - Self.Width) / 2
                                    Y: ='Profile.Avatar.Circle'.Y + ('Profile.Avatar.Circle'.Height - Self.Height) / 2
                                    Width: ='Profile.Avatar.Circle'.Width * 0.6
                                    Height: ='Profile.Avatar.Circle'.Height * 0.6
                                    Text: =If(IsBlank(User.HoTen), "U", Upper(Left(User.HoTen, 1)))
                                    Color: =RGBA(33, 150, 243, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =Parent.Height * 0.25
                                    Align: =Align.Center
                                    
                              - 'Profile.Avatar.Status':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: ='Profile.Avatar.Circle'.Y + 'Profile.Avatar.Circle'.Height + Parent.Height * 0.05
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.2
                                    Text: =Switch(If(IsBlank(User.TrangThai), "HoatDong", User.TrangThai),
                                      "HoatDong", "Ho·∫°t ƒë·ªông",
                                      "KhongHoatDong", "Kh√¥ng ho·∫°t ƒë·ªông",
                                      "TamNghi", "T·∫°m ngh·ªâ",
                                      "Ho·∫°t ƒë·ªông")
                                    Color: =Switch(If(IsBlank(User.TrangThai), "HoatDong", User.TrangThai),
                                      "HoatDong", RGBA(76, 175, 80, 1),
                                      "KhongHoatDong", RGBA(244, 67, 54, 1),
                                      RGBA(255, 152, 0, 1))
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =12
                                    Align: =Align.Center
                                    
                        # Basic Info Section
                        - 'Profile.BasicInfo.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.3
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.45
                              Height: =Parent.Height * 0.8
                            Children:
                              - 'Profile.BasicInfo.Name':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.25
                                    Text: =If(IsBlank(User.HoTen), "ƒêang t·∫£i...", User.HoTen)
                                    Color: =RGBA(55, 65, 81, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =22
                                    
                              - 'Profile.BasicInfo.ID':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =Parent.Height * 0.25
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.2
                                    Text: ="M√£ NV:" & " " & If(IsBlank(User.Id), "ƒêang t·∫£i...", User.Id)
                                    Color: =RGBA(107, 114, 128, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =14
                                    
                              - 'Profile.BasicInfo.Role':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =Parent.Height * 0.45
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.2
                                    Text: =Switch(If(IsBlank(User.MaVaiTro), "Employee", User.MaVaiTro),
                                      "Employee", "Nh√¢n vi√™n",
                                      "Manager", "Tr∆∞·ªüng ph√≤ng", 
                                      "ADMIN", "Qu·∫£n tr·ªã vi√™n",
                                      "HR", "Nh√¢n s·ª±",
                                      "Employee")
                                    Color: =RGBA(33, 150, 243, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =16
                                    
                              - 'Profile.BasicInfo.Department':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =Parent.Height * 0.65
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.35
                                    Text: =Concatenate(
                                      If(IsBlank(varUserDepartment.TenDonVi), "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin", varUserDepartment.TenDonVi),
                                      Char(10),
                                      "Email:" & " " & If(IsBlank(User.Email), "user@company.com", User.Email)
                                    )
                                    Color: =RGBA(107, 114, 128, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =13
                                    
                        # Edit Profile Button
                        - 'Profile.EditButton':
                            Control: Classic/Button
                            Properties:
                              X: =Parent.Width * 0.77
                              Y: =Parent.Height * 0.15
                              Width: =Parent.Width * 0.18
                              Height: =Parent.Height * 0.15
                              Text: =If(varEditMode, "L∆∞u", "Ch·ªânh s·ª≠a")
                              Fill: =If(varEditMode, RGBA(76, 175, 80, 1), RGBA(33, 150, 243, 1))
                              Color: =RGBA(255, 255, 255, 1)
                              BorderColor: =If(varEditMode, RGBA(76, 175, 80, 1), RGBA(33, 150, 243, 1))
                              BorderThickness: =1
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Semibold
                              Size: =13
                              OnSelect: |
                                =Set(varEditMode, !varEditMode)
                                
                  # Leave Balance Section
                  - 'Profile.LeaveBalance.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Profile.Info.Header'.Y + 'Profile.Info.Header'.Height + Parent.Height * 0.02
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.18
                      Children:
                        - 'Profile.LeaveBalance.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(224, 224, 224, 1)
                              BorderThickness: =1
                              
                        - 'Profile.LeaveBalance.Title':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.1
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.25
                              Text: ="Th√¥ng tin ng√†y ph√©p " & Year(Today())
                              Color: =RGBA(55, 65, 81, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Profile.LeaveBalance.Stats':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.4
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.5
                            Children:
                              - 'Profile.LeaveBalance.Total':
                                  Control: Label
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width * 0.3
                                    Height: =Parent.Height
                                    Text: ="T·ªïng ph√©p:" & " " & varUserLeaveBalance.TongNgayDuocPhep & " ng√†y"
                                    Color: =RGBA(33, 150, 243, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =14
                                    
                              - 'Profile.LeaveBalance.Used':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.35
                                    Y: =0
                                    Width: =Parent.Width * 0.3
                                    Height: =Parent.Height
                                    Text: ="ƒê√£ d√πng:" & " " & varUserLeaveBalance.SoNgayDaNghi & " ng√†y"
                                    Color: =RGBA(76, 175, 80, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =14
                                    
                              - 'Profile.LeaveBalance.Remaining':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.7
                                    Y: =0
                                    Width: =Parent.Width * 0.3
                                    Height: =Parent.Height
                                    Text: ="C√≤n l·∫°i:" & " " & varUserLeaveBalance.SoNgayConLai & " ng√†y"
                                    Color: =RGBA(255, 152, 0, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =14

            # Detailed Info Tabs
            - 'Profile.Tabs.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.03
                  Y: ='Profile.Info.Header'.Y + 'Profile.Info.Header'.Height + Parent.Height * 0.02
                  Width: =Parent.Width * 0.94
                  Height: =Parent.Height * 0.68
                  Fill: =RGBA(255, 255, 255, 1)
                  BorderColor: =RGBA(230, 230, 230, 1)
                  BorderThickness: =Parent.Width * 0.001
                  DropShadow: =DropShadow.Light
                Children:
                  # Tab Headers
                  - 'Profile.TabHeaders.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =Parent.Width * 0.02
                        Y: =Parent.Height * 0.02
                        Width: =Parent.Width * 0.96
                        Height: =Parent.Height * 0.08
                        Fill: =RGBA(248, 249, 250, 1)
                        BorderColor: =RGBA(229, 231, 235, 1)
                        BorderThickness: =Parent.Width * 0.0005
                      Children:
                        - 'Profile.Tab.Personal':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.18
                              Height: =Parent.Height * 0.8
                              Text: ="Th√¥ng tin c√° nh√¢n"
                              Variant: =If(varSelectedTab = "Personal" Or IsBlank(varSelectedTab), "Primary", "Ghost")
                              Size: ="Small"
                              OnClick: =Set(varSelectedTab, "Personal")
                              
                        - 'Profile.Tab.Leave':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.22
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.18
                              Height: =Parent.Height * 0.8
                              Text: ="Ngh·ªâ ph√©p"
                              Variant: =If(varSelectedTab = "Leave", "Primary", "Ghost")
                              Size: ="Small"
                              OnClick: =Set(varSelectedTab, "Leave")
                              
                        - 'Profile.Tab.Settings':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.42
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.18
                              Height: =Parent.Height * 0.8
                              Text: ="C√†i ƒë·∫∑t"
                              Variant: =If(varSelectedTab = "Settings", "Primary", "Ghost")
                              Size: ="Small"
                              OnClick: =Set(varSelectedTab, "Settings")
                              
                  # Tab Content
                  - 'Profile.TabContent.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =Parent.Width * 0.02
                        Y: ='Profile.TabHeaders.Container'.Y + 'Profile.TabHeaders.Container'.Height + Parent.Height * 0.02
                        Width: =Parent.Width * 0.96
                        Height: =Parent.Height * 0.85
                      Children:
                        # Personal Info Tab
                        - 'Profile.PersonalInfo.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.X
                              Y: =Parent.Y
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Visible: =varSelectedTab = "Personal" Or IsBlank(varSelectedTab)
                            Children:
                              - 'Profile.PersonalInfo.Details':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.02
                                    Y: =Parent.Height * 0.02
                                    Width: =Parent.Width * 0.96
                                    Height: =Parent.Height * 0.96
                                    Text: =Concatenate(
                                      "üìß Email:" & " " & varCurrentUser.Email, Char(10), Char(10),
                                      "üìû S·ªë ƒëi·ªán tho·∫°i:" & " " & If(IsBlank(varCurrentUser.SoDienThoai), "Ch∆∞a c·∫≠p nh·∫≠t", varCurrentUser.SoDienThoai), Char(10), Char(10),
                                      "üíº Ch·ª©c danh:" & " " & If(IsBlank(varCurrentUser.ChucDanh), "Ch∆∞a c·∫≠p nh·∫≠t", varCurrentUser.ChucDanh), Char(10), Char(10),
                                      "üéÇ Ng√†y sinh:" & " " & If(IsBlank(varCurrentUser.NgaySinh), "Ch∆∞a c·∫≠p nh·∫≠t", Text(varCurrentUser.NgaySinh, "dd/mm/yyyy")), Char(10), Char(10),
                                      "üë§ Gi·ªõi t√≠nh:" & " " & If(IsBlank(varCurrentUser.GioiTinh), "Ch∆∞a c·∫≠p nh·∫≠t", varCurrentUser.GioiTinh), Char(10), Char(10),
                                      "üìç ƒê·ªãa ch·ªâ:" & " " & If(IsBlank(varCurrentUser.DiaChi), "Ch∆∞a c·∫≠p nh·∫≠t", varCurrentUser.DiaChi), Char(10), Char(10),
                                      "üìÖ Ng√†y v√†o l√†m:" & " " & If(IsBlank(varCurrentUser.NgayVaoLam), "Ch∆∞a c·∫≠p nh·∫≠t", Text(varCurrentUser.NgayVaoLam, "dd/mm/yyyy")), Char(10), Char(10),
                                      "üìù Ng√†y t·∫°o:" & " " & Text(varCurrentUser.NgayTao, "dd/mm/yyyy hh:mm")
                                    )
                                    Color: =RGBA(55, 65, 81, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =14
                                    
                        # Leave Info Tab
                        - 'Profile.LeaveInfo.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.X
                              Y: =Parent.Y
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Visible: =varSelectedTab = "Leave"
                            Children:
                              - 'Profile.LeaveInfo.Stats':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =Parent.X
                                    Y: =Parent.Y
                                    Width: =Parent.Width
                                    Height: =Parent.Height * 0.3
                                  Children:
                                    - 'Profile.LeaveStats.Total':
                                        Control: CanvasComponent
                                        ComponentName: StatsCardComponent
                                        Properties:
                                          X: =Parent.X
                                          Y: =Parent.Y
                                          Width: =Parent.Width * 0.32
                                          Height: =Parent.Height
                                          Title: ="T·ªïng ng√†y ph√©p"
                                          Value: =If(Not(IsBlank(varUserLeaveBalance)), Text(varUserLeaveBalance.TongNgayDuocPhep), "0")
                                          Icon: ="Calendar"
                                          BackgroundColor: =RGBA(33, 150, 243, 0.1)
                                          IconColor: =RGBA(33, 150, 243, 1)
                                          
                                    - 'Profile.LeaveStats.Used':
                                        Control: CanvasComponent
                                        ComponentName: StatsCardComponent
                                        Properties:
                                          X: =Parent.Width * 0.34
                                          Y: =Parent.Y
                                          Width: =Parent.Width * 0.32
                                          Height: =Parent.Height
                                          Title: ="ƒê√£ s·ª≠ d·ª•ng"
                                          Value: =If(Not(IsBlank(varUserLeaveBalance)), Text(varUserLeaveBalance.SoNgayDaNghi), "0")
                                          Icon: ="CheckMark"
                                          BackgroundColor: =RGBA(76, 175, 80, 0.1)
                                          IconColor: =RGBA(76, 175, 80, 1)
                                          
                                    - 'Profile.LeaveStats.Remaining':
                                        Control: CanvasComponent
                                        ComponentName: StatsCardComponent
                                        Properties:
                                          X: =Parent.Width * 0.68
                                          Y: =Parent.Y
                                          Width: =Parent.Width * 0.32
                                          Height: =Parent.Height
                                          Title: ="C√≤n l·∫°i"
                                          Value: =If(Not(IsBlank(varUserLeaveBalance)), Text(varUserLeaveBalance.SoNgayConLai), "0")
                                          Icon: ="Clock"
                                          BackgroundColor: =RGBA(255, 152, 0, 0.1)
                                          IconColor: =RGBA(255, 152, 0, 1)
                                          
                              - 'Profile.LeaveInfo.History':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.02
                                    Y: =Parent.Height * 0.35
                                    Width: =Parent.Width * 0.96
                                    Height: =Parent.Height * 0.6
                                    Text: =Concatenate(
                                      "üìä TH·ªêNG K√ä NGH·ªà PH√âP NƒÇM " & Year(Today()), Char(10), Char(10),
                                      "‚Ä¢ T·ªïng ƒë∆°n ƒë√£ t·∫°o:" & " " & CountRows(varUserLeaveHistory), Char(10),
                                      "‚Ä¢ ƒê∆°n ch·ªù duy·ªát:" & " " & CountRows(Filter(varUserLeaveHistory, TrangThai in ["ChoDuyetCap1", "ChoDuyetCap2", "ChoDuyetCap3"])), Char(10),
                                      "‚Ä¢ ƒê∆°n ƒë√£ duy·ªát:" & " " & CountRows(Filter(varUserLeaveHistory, TrangThai = "DaDuyet")), Char(10),
                                      "‚Ä¢ ƒê∆°n b·ªã t·ª´ ch·ªëi:" & " " & CountRows(Filter(varUserLeaveHistory, TrangThai = "TuChoi")), Char(10), Char(10),
                                      "üìà ƒê∆°n g·∫ßn nh·∫•t:", Char(10),
                                      If(CountRows(varUserLeaveHistory) > 0,
                                        With(Last(Sort(varUserLeaveHistory, NgayTao, Descending)),
                                          Concatenate(
                                            "‚Ä¢ Ng√†y:" & " " & Text(NgayBatDau, "dd/mm/yyyy") & " - " & Text(NgayKetThuc, "dd/mm/yyyy"), Char(10),
                                            "‚Ä¢ Lo·∫°i:" & " " & LookUp(LoaiNghi, MaLoai = ThisRecord.MaLoai).TenLoai, Char(10),
                                            "‚Ä¢ Tr·∫°ng th√°i:" & " " & Switch(TrangThai, "DaDuyet", "ƒê√£ duy·ªát", "TuChoi", "T·ª´ ch·ªëi", "Ch·ªù duy·ªát")
                                          )),
                                        "Ch∆∞a c√≥ ƒë∆°n n√†o")
                                    )
                                    Color: =RGBA(55, 65, 81, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =14
                                    
            # Success/Error Messages
            - 'Profile.Messages.Container':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.03
                  Y: =Parent.Height * 0.95
                  Width: =Parent.Width * 0.94
                  Height: =Parent.Height * 0.03
                  Visible: =varUpdateSuccess Or Not(IsBlank(varProfileErrors))
                Children:
                  - 'Profile.Success.Message':
                      Control: Label
                      Properties:
                        X: =Parent.X
                        Y: =Parent.Y
                        Width: =Parent.Width
                        Height: =Parent.Height
                        Text: ="‚úÖ C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!"
                        Color: =RGBA(76, 175, 80, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =14
                        Align: =Align.Center
                        Visible: =varUpdateSuccess
                        
                  - 'Profile.Error.Message':
                      Control: Label
                      Properties:
                        X: =Parent.X
                        Y: =Parent.Y
                        Width: =Parent.Width
                        Height: =Parent.Height
                        Text: ="‚ùå " & varProfileErrors
                        Color: =RGBA(244, 67, 54, 1)
                        Font: =Font.'Open Sans'
                        FontWeight: =FontWeight.Semibold
                        Size: =14
                        Align: =Align.Center
                        Visible: =Not(IsBlank(varProfileErrors))

                  # Recent Leave History Section
                  - 'Profile.RecentHistory.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Profile.LeaveBalance.Container'.Y + 'Profile.LeaveBalance.Container'.Height + Parent.Height * 0.02
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.53
                      Children:
                        - 'Profile.RecentHistory.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(224, 224, 224, 1)
                              BorderThickness: =1
                              
                        - 'Profile.RecentHistory.Title':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.05
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.1
                              Text: ="L·ªãch s·ª≠ ngh·ªâ ph√©p g·∫ßn ƒë√¢y"
                              Color: =RGBA(55, 65, 81, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =16
                              
                        - 'Profile.RecentHistory.Gallery':
                            Control: Gallery
                            Variant: Vertical
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.18
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.77
                              Items: =varUserLeaveHistory
                              TemplateSize: =Self.Height / 4
                              TemplatePadding: =4
                            Children:
                              - 'HistoryItem.Container':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.TemplateWidth
                                    Height: =Parent.TemplateHeight - 8
                                    Fill: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", RGBA(76, 175, 80, 0.1), 
                                      "TuChoi", RGBA(244, 67, 54, 0.1), 
                                      "ChoDuyetCap1", RGBA(255, 193, 7, 0.1),
                                      "ChoDuyetCap2", RGBA(255, 193, 7, 0.1),
                                      "ChoDuyetCap3", RGBA(255, 193, 7, 0.1),
                                      RGBA(248, 250, 252, 1))
                                    BorderColor: =RGBA(224, 224, 224, 1)
                                    BorderThickness: =1
                                    
                              - 'HistoryItem.Date':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.02
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.25
                                    Height: =Parent.TemplateHeight * 0.4
                                    Text: =Text(ThisItem.NgayBatDau, "dd/mm/yyyy")
                                    Color: =RGBA(55, 65, 81, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =11
                                    
                              - 'HistoryItem.Type':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.3
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.25
                                    Height: =Parent.TemplateHeight * 0.4
                                    Text: =Switch(ThisItem.MaLoai, "Annual", "Ph√©p nƒÉm", "Sick", "·ªêm ƒëau", "Personal", "C√° nh√¢n", "Ph√©p nƒÉm")
                                    Color: =RGBA(55, 65, 81, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =11
                                    
                              - 'HistoryItem.Status':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.58
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.2
                                    Height: =Parent.TemplateHeight * 0.4
                                    Text: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", "ƒê√£ duy·ªát", 
                                      "TuChoi", "T·ª´ ch·ªëi", 
                                      "ChoDuyetCap1", "Ch·ªù duy·ªát",
                                      "ChoDuyetCap2", "Ch·ªù duy·ªát", 
                                      "ChoDuyetCap3", "Ch·ªù duy·ªát",
                                      "Huy", "ƒê√£ h·ªßy", 
                                      "ƒêang x·ª≠ l√Ω")
                                    Color: =Switch(ThisItem.TrangThai, 
                                      "DaDuyet", RGBA(76, 175, 80, 1), 
                                      "TuChoi", RGBA(244, 67, 54, 1), 
                                      "ChoDuyetCap1", RGBA(255, 152, 0, 1),
                                      "ChoDuyetCap2", RGBA(255, 152, 0, 1),
                                      "ChoDuyetCap3", RGBA(255, 152, 0, 1),
                                      RGBA(107, 114, 128, 1))
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =11
                                    
                              - 'HistoryItem.Days':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.8
                                    Y: =Parent.TemplateHeight * 0.1
                                    Width: =Parent.TemplateWidth * 0.18
                                    Height: =Parent.TemplateHeight * 0.4
                                    Text: =ThisItem.SoNgayNghi & " ng√†y"
                                    Color: =RGBA(107, 114, 128, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =11
                                    Align: =Align.Center
                                    
                              - 'HistoryItem.Period':
                                  Control: Label
                                  Properties:
                                    X: =Parent.TemplateWidth * 0.02
                                    Y: =Parent.TemplateHeight * 0.55
                                    Width: =Parent.TemplateWidth * 0.96
                                    Height: =Parent.TemplateHeight * 0.35
                                    Text: ="T·ª´ " & Text(ThisItem.NgayBatDau, "dd/mm") & " ƒë·∫øn " & Text(ThisItem.NgayKetThuc, "dd/mm")
                                    Color: =RGBA(107, 114, 128, 1)
                                    Font: =Font.'Open Sans'
                                    Size: =10
                                    
                        # Quick Actions
                        - 'Profile.QuickActions.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.96
                              Width: =Parent.Width * 0.94
                              Height: =Parent.Height * 0.02
                              Visible: =false
                            Children:
                              - 'Profile.QuickActions.NewRequest':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width * 0.3
                                    Height: =Parent.Height
                                    Text: ="T·∫°o ƒë∆°n m·ªõi"
                                    Variant: ="Primary"
                                    Size: ="Small"
                                    Icon: ="Add"
                                    IconPosition: ="Left"
                                    IsDisabled: =false
                                    IsLoading: =false
                                    LoadingText: ="ƒêang x·ª≠ l√Ω..."
                                    FullWidth: =false
                                    OnClick: |
                                      =Navigate(LeaveRequestScreen)
                                      
                              - 'Profile.QuickActions.ViewAll':
                                  Control: CanvasComponent
                                  ComponentName: ButtonComponent
                                  Properties:
                                    X: =Parent.Width * 0.35
                                    Y: =0
                                    Width: =Parent.Width * 0.3
                                    Height: =Parent.Height
                                    Text: ="Xem t·∫•t c·∫£"
                                    Variant: ="Outline"
                                    Size: ="Small"
                                    Icon: ="View"
                                    IconPosition: ="Left"
                                    IsDisabled: =false
                                    IsLoading: =false
                                    LoadingText: ="ƒêang x·ª≠ l√Ω..."
                                    FullWidth: =false
                                    OnClick: |
                                      =Navigate(MyLeavesScreen) 
