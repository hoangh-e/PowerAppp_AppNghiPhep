Screens:
  ProfileScreen:
    Properties:
      Fill: =RGBA(248, 250, 252, 1)
      OnVisible: |
        =Set(varActiveScreen, "Profile");
        Set(varIsEditing, false);
        Set(varEditedName, UserSession.HoTen);
        Set(varEditedEmail, UserSession.Email);
        Set(varEditedPhone, "");
            Set(varIsSaving, false);
        Set(varCurrentUser, LookUp(NguoiDung, Title = UserSession.Id));
        Set(varUserLeaveBalance, LookUp(SoNgayPhep, And(MaNhanVien.Value = UserSession.Id, Nam = Year(Today()))));
        Set(varUserLeaveHistory, Filter(DonNghiPhep, MaNguoiDung.Value = UserSession.Id));
        Set(varSelectedTab, "Info")
    Children:
      # Header Component
      - 'Profile.Header':
          Control: CanvasComponent
          ComponentName: HeaderComponent
          Properties:
            X: =0
            Y: =0
            Width: =Parent.Width
            Height: =Parent.Height * 0.065
            UserName: =UserSession.HoTen
            UserRole: =UserSession.MaVaiTro
            ShowNotification: =true
            NotificationCount: =0
            OnLogout: |
              =Set(varIsUserAuthenticated, false);
              Set(UserSession, {
                Id: "", 
                Name: "", 
                Email: "", 
                Role: "", 
                Permission: 0,
                NguoiQuanLyId: "", 
                HoTen: "", 
                MaVaiTro: "", 
                ChucDanh: "", 
                MaDonVi: "", 
                TrangThai: ""
              });
              Navigate(LoginScreen)
            
      # Navigation Component
      - 'Profile.Navigation':
          Control: CanvasComponent
          ComponentName: NavigationComponent
          Properties:
            X: =0
            Y: ='Profile.Header'.Height
            Width: =If(varNavCollapsed, App.Width * 0.045, App.Width * 0.14)
            Height: =Parent.Height - 'Profile.Header'.Height
            UserRole: =UserSession.MaVaiTro
            ActiveScreen: ="Profile"
            IsCollapsed: =varNavCollapsed
            DashboardScreen: =DashboardScreen
            LeaveRequestScreen: =LeaveRequestScreen
            MyLeavesScreen: =MyLeavesScreen
            CalendarScreen: =CalendarScreen
            ManagementScreen: =ManagementScreen
            ProfileScreen: =ProfileScreen
            OnNavigate: |
              =Set(varActiveScreen, ScreenName);
              Switch(ScreenName,
                "Dashboard", Navigate(DashboardScreen),
                "LeaveRequest", Navigate(LeaveRequestScreen),
                "MyLeaves", Navigate(MyLeavesScreen),
                "Calendar", Navigate(CalendarScreen),
                "Management", Navigate(ManagementScreen),
                "Profile", Navigate(ProfileScreen),
                "Approval", Navigate(ApprovalScreen),
                "Reports", Navigate(ReportsScreen)
              )
            OnToggleCollapse: |
              =Set(varNavCollapsed, !varNavCollapsed)
            
      # Main Content Container
      - 'Profile.Content.Container':
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            X: ='Profile.Navigation'.Width
            Y: ='Profile.Header'.Height
            Width: =Parent.Width - 'Profile.Navigation'.Width
            Height: =Parent.Height - 'Profile.Header'.Height
          Children:
            - 'Profile.Content.Padded':
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  X: =Parent.Width * 0.01
                  Y: =Parent.Height * 0.01
                  Width: =Parent.Width * 0.98
                  Height: =Parent.Height * 0.98
                Children:
                  # Page Header
                  - 'Profile.PageHeader.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: =0
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.1
                      Children:
                        - 'Profile.PageHeader.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(255, 255, 255, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        - 'Profile.PageHeader.Icon':
                            Control: Classic/Icon
                            Properties:
                              X: =Parent.Width * 0.015
                              Y: =Parent.Height * 0.25
                              Width: =Parent.Height * 0.2
                              Height: =Parent.Height * 0.2
                              Icon: =Icon.Person
                              Color: =RGBA(59, 130, 246, 1)
                              
                        - 'Profile.PageHeader.Title':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.015 + 'Profile.PageHeader.Icon'.Width + Parent.Width * 0.01
                              Y: =Parent.Height * 0.2
                              Width: =Parent.Width * 0.6
                              Height: =Parent.Height * 0.35
                              Text: ="Thông tin cá nhân"
                              Color: =RGBA(17, 24, 39, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Size: =14
                                    
                        - 'Profile.PageHeader.Stats':
                            Control: Label
                            Properties:
                              X: =Parent.Width * 0.015 + 'Profile.PageHeader.Icon'.Width + Parent.Width * 0.01
                              Y: =Parent.Height * 0.6
                              Width: =Parent.Width * 0.6
                              Height: =Parent.Height * 0.25
                              Text: =Concatenate("Nhân viên" & ":" & " ", UserSession.HoTen, " | ", UserSession.MaVaiTro)
                              Color: =RGBA(75, 85, 99, 1)
                              Font: =Font.'Open Sans'
                              Size: =11
                                
                  # Tab Navigation
                  - 'Profile.Tabs.Container':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Profile.PageHeader.Container'.Y + 'Profile.PageHeader.Container'.Height + Parent.Height * 0.015
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.08
                      Children:
                        - 'Profile.Tabs.Background':
                            Control: Rectangle
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Fill: =RGBA(249, 250, 251, 1)
                              BorderColor: =RGBA(226, 232, 240, 1)
                              BorderThickness: =1
                              
                        - 'Profile.Tabs.Info':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.02
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.15
                              Height: =Parent.Height * 0.7
                              Text: ="Thông tin"
                              Variant: =If(varSelectedTab = "Info", "Primary", "Outline")
                              Size: ="Small"
                              OnClick: |
                                =Set(varSelectedTab, "Info")
                              
                        - 'Profile.Tabs.LeaveBalance':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.18
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.15
                              Height: =Parent.Height * 0.7
                              Text: ="Số ngày phép"
                              Variant: =If(varSelectedTab = "LeaveBalance", "Primary", "Outline")
                              Size: ="Small"
                              OnClick: |
                                =Set(varSelectedTab, "LeaveBalance")
                              
                        - 'Profile.Tabs.History':
                            Control: CanvasComponent
                            ComponentName: ButtonComponent
                            Properties:
                              X: =Parent.Width * 0.34
                              Y: =(Parent.Height - Self.Height) / 2
                              Width: =Parent.Width * 0.15
                              Height: =Parent.Height * 0.7
                              Text: ="Lịch sử nghỉ phép"
                              Variant: =If(varSelectedTab = "History", "Primary", "Outline")
                              Size: ="Small"
                              OnClick: |
                                =Set(varSelectedTab, "History")
                              
                  # Content Area
                  - 'Profile.Content.Area':
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        X: =0
                        Y: ='Profile.Tabs.Container'.Y + 'Profile.Tabs.Container'.Height + Parent.Height * 0.015
                        Width: =Parent.Width
                        Height: =Parent.Height * 0.77
                      Children:
                        # Personal Info Tab
                        - 'Profile.Info.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Visible: =varSelectedTab = "Info"
                            Children:
                              - 'Profile.Info.Background':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width
                                    Height: =Parent.Height
                                    Fill: =RGBA(255, 255, 255, 1)
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              # Avatar Section
                              - 'Profile.Info.Avatar.Container':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.03
                                    Width: =Parent.Width * 0.94
                                    Height: =Parent.Height * 0.2
                                  Children:
                                    - 'Profile.Info.Avatar.Icon':
                                        Control: Classic/Icon
                                        Properties:
                                          X: =Parent.Width * 0.02
                                          Y: =(Parent.Height - Self.Height) / 2
                                          Width: =Parent.Height * 0.8
                                          Height: =Parent.Height * 0.8
                                          Icon: =Icon.Person
                                          Color: =RGBA(59, 130, 246, 1)
                                          Fill: =RGBA(219, 234, 254, 1)
                                          BorderColor: =RGBA(147, 197, 253, 1)
                                          BorderThickness: =2
                                          
                                    - 'Profile.Info.Avatar.Name':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Height * 0.9
                                          Y: =Parent.Height * 0.1
                                          Width: =Parent.Width * 0.6
                                          Height: =Parent.Height * 0.4
                                          Text: =If(Not(IsBlank(varCurrentUser)), varCurrentUser.HoTen, UserSession.HoTen)
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Bold
                                          Size: =18
                                          
                                    - 'Profile.Info.Avatar.Role':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Height * 0.9
                                          Y: =Parent.Height * 0.55
                                          Width: =Parent.Width * 0.6
                                          Height: =Parent.Height * 0.35
                                          Text: =If(Not(IsBlank(varCurrentUser)), varCurrentUser.ChucDanh.Value & " - " & LookUp(DonVi, MaDonVi = varCurrentUser.MaDonVi.Value).TenDonVi, UserSession.ChucDanh)
                                          Color: =RGBA(75, 85, 99, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =14
                                          
                                    - 'Profile.Info.EditButton':
                                        Control: CanvasComponent
                                        ComponentName: ButtonComponent
                                        Properties:
                                          X: =Parent.Width * 0.8
                                          Y: =(Parent.Height - Self.Height) / 2
                                          Width: =Parent.Width * 0.17
                                          Height: =Parent.Height * 0.5
                                          Text: =If(varIsEditing, "Hủy", "Chỉnh sửa")
                                          Variant: =If(varIsEditing, "Outline", "Primary")
                                          Size: ="Small"
                                          OnClick: |
                                            =If(varIsEditing,
                                              Set(varIsEditing, false);
                                              Set(varEditedName, If(Not(IsBlank(varCurrentUser)), varCurrentUser.HoTen, UserSession.HoTen));
                                              Set(varEditedEmail, If(Not(IsBlank(varCurrentUser)), varCurrentUser.Email, UserSession.Email)),
                                              Set(varIsEditing, true)
                                            )

                              # Info Form
                              - 'Profile.Info.Form.Container':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.25
                                    Width: =Parent.Width * 0.94
                                    Height: =Parent.Height * 0.7
                                  Children:
                                    # Employee ID
                                    - 'Profile.Info.ID.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =0
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Mã nhân viên:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.ID.Value':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =0
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Text: =UserSession.Id
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =13

                                    # Full Name
                                    - 'Profile.Info.Name.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.12
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Họ và tên:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.Name.Input':
                                        Control: Classic/TextInput
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =Parent.Height * 0.12
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Default: =varEditedName
                                          DisplayMode: =If(varIsEditing, DisplayMode.Edit, DisplayMode.View)
                                          Color: =RGBA(55, 65, 81, 1)
                                          Fill: =If(varIsEditing, RGBA(255, 255, 255, 1), RGBA(249, 250, 251, 1))
                                          BorderColor: =If(varIsEditing, RGBA(59, 130, 246, 1), RGBA(226, 232, 240, 1))
                                          BorderThickness: =1
                                          Font: =Font.'Open Sans'
                                          Size: =13
                                          OnChange: |
                                            =Set(varEditedName, Self.Text)

                                    # Email
                                    - 'Profile.Info.Email.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.24
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Email:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.Email.Input':
                                        Control: Classic/TextInput
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =Parent.Height * 0.24
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Default: =varEditedEmail
                                          DisplayMode: =If(varIsEditing, DisplayMode.Edit, DisplayMode.View)
                                          Color: =RGBA(55, 65, 81, 1)
                                          Fill: =If(varIsEditing, RGBA(255, 255, 255, 1), RGBA(249, 250, 251, 1))
                                          BorderColor: =If(varIsEditing, RGBA(59, 130, 246, 1), RGBA(226, 232, 240, 1))
                                          BorderThickness: =1
                                          Font: =Font.'Open Sans'
                                          Size: =13
                                          OnChange: |
                                            =Set(varEditedEmail, Self.Text)

                                    # Phone
                                    - 'Profile.Info.Phone.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.36
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Số điện thoại:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.Phone.Input':
                                        Control: Classic/TextInput
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =Parent.Height * 0.36
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Default: =If(Not(IsBlank(varCurrentUser.SoDienThoai)), varCurrentUser.SoDienThoai, "")
                                          DisplayMode: =If(varIsEditing, DisplayMode.Edit, DisplayMode.View)
                                          Color: =RGBA(55, 65, 81, 1)
                                          Fill: =If(varIsEditing, RGBA(255, 255, 255, 1), RGBA(249, 250, 251, 1))
                                          BorderColor: =If(varIsEditing, RGBA(59, 130, 246, 1), RGBA(226, 232, 240, 1))
                                          BorderThickness: =1
                                          Font: =Font.'Open Sans'
                                          Size: =13
                                          OnChange: |
                                            =Set(varEditedPhone, Self.Text)

                                    # Department
                                    - 'Profile.Info.Department.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.48
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Phòng ban:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.Department.Value':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =Parent.Height * 0.48
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Text: =If(Not(IsBlank(varCurrentUser)), LookUp(DonVi, MaDonVi = varCurrentUser.MaDonVi.Value).TenDonVi, "")
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =13

                                    # Position
                                    - 'Profile.Info.Position.Label':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.6
                                          Width: =Parent.Width * 0.3
                                          Height: =Parent.Height * 0.08
                                          Text: ="Chức danh:"
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Size: =13
                                          
                                    - 'Profile.Info.Position.Value':
                                        Control: Label
                                        Properties:
                                          X: =Parent.Width * 0.32
                                          Y: =Parent.Height * 0.6
                                          Width: =Parent.Width * 0.68
                                          Height: =Parent.Height * 0.08
                                          Text: =If(Not(IsBlank(varCurrentUser)), varCurrentUser.ChucDanh.Value, UserSession.ChucDanh)
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =13

                                    # Save Button
                                    - 'Profile.Info.SaveButton':
                                        Control: CanvasComponent
                                        ComponentName: ButtonComponent
                                        Properties:
                                          X: =Parent.Width * 0.75
                                          Y: =Parent.Height * 0.8
                                          Width: =Parent.Width * 0.23
                                          Height: =Parent.Height * 0.1
                                          Text: =If(varIsSaving, "Đang lưu...", "Lưu thay đổi")
                                          Variant: ="Primary"
                                          Size: ="Medium"
                                          Visible: =varIsEditing
                                          IsDisabled: =Or(varIsSaving, IsBlank(varEditedName), IsBlank(varEditedEmail))
                                          OnClick: |
                                            =Set(varIsSaving, true);
                                            Patch(NguoiDung, varCurrentUser, {
                                              HoTen: varEditedName,
                                              Email: varEditedEmail,
                                              SoDienThoai: varEditedPhone
                                            });
                                            Set(UserSession, {
                                              Id: UserSession.Id,
                                              Name: varEditedName,
                                              Email: varEditedEmail,
                                              Role: UserSession.Role,
                                              Permission: UserSession.Permission,
                                              NguoiQuanLyId: UserSession.NguoiQuanLyId,
                                              HoTen: varEditedName,
                                              MaVaiTro: UserSession.MaVaiTro,
                                              ChucDanh: UserSession.ChucDanh,
                                              MaDonVi: UserSession.MaDonVi,
                                              TrangThai: UserSession.TrangThai
                                            });
                                            Set(varIsSaving, false);
                                            Set(varIsEditing, false);
                                            Notify("Đã cập nhật thông tin thành công!", NotificationType.Success)

                        # Leave Balance Tab
                        - 'Profile.LeaveBalance.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Visible: =varSelectedTab = "LeaveBalance"
                            Children:
                              - 'Profile.LeaveBalance.Background':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width
                                    Height: =Parent.Height
                                    Fill: =RGBA(255, 255, 255, 1)
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              # Current Year Stats
                              - 'Profile.LeaveBalance.CurrentYear':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.05
                                    Width: =Parent.Width * 0.44
                                    Height: =Parent.Height * 0.25
                                    Title: =Concatenate("Năm ", Year(Today()))
                                    Value: =If(Not(IsBlank(varUserLeaveBalance)), varUserLeaveBalance.TongNgayDuocPhep, 0)
                                    Icon: ="CalendarBlank"
                                    Color: =RGBA(59, 130, 246, 1)
                                    ShowTrend: =false
                                    
                              # Remaining Days
                              - 'Profile.LeaveBalance.Remaining':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =Parent.Width * 0.53
                                    Y: =Parent.Height * 0.05
                                    Width: =Parent.Width * 0.44
                                    Height: =Parent.Height * 0.25
                                    Title: ="Còn lại"
                                    Value: =If(Not(IsBlank(varUserLeaveBalance)), varUserLeaveBalance.SoNgayConLai, 0)
                                    Icon: ="Timer"
                                    Color: =RGBA(34, 197, 94, 1)
                                    ShowTrend: =false
                                    
                              # Used Days
                              - 'Profile.LeaveBalance.Used':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.35
                                    Width: =Parent.Width * 0.44
                                    Height: =Parent.Height * 0.25
                                    Title: ="Đã sử dụng"
                                    Value: =If(Not(IsBlank(varUserLeaveBalance)), varUserLeaveBalance.SoNgayDaNghi, 0)
                                    Icon: ="CheckBadge"
                                    Color: =RGBA(139, 69, 19, 1)
                                    ShowTrend: =false
                                    
                              # Pending Days
                              - 'Profile.LeaveBalance.Pending':
                                  Control: CanvasComponent
                                  ComponentName: StatsCardComponent
                                  Properties:
                                    X: =Parent.Width * 0.53
                                    Y: =Parent.Height * 0.35
                                    Width: =Parent.Width * 0.44
                                    Height: =Parent.Height * 0.25
                                    Title: ="Đang chờ duyệt"
                                    Value: =Sum(Filter(varUserLeaveHistory, TrangThai.Value in ["ChoDuyetCap1", "ChoDuyetCap2", "ChoDuyetCap3"]), SoNgayNghi)
                                    Icon: ="Clock"
                                    Color: =RGBA(251, 191, 36, 1)
                                    ShowTrend: =false

                              # Annual Leave Breakdown
                              - 'Profile.LeaveBalance.Details.Container':
                                  Control: GroupContainer
                                  Variant: ManualLayout
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.65
                                    Width: =Parent.Width * 0.94
                                    Height: =Parent.Height * 0.3
                                  Children:
                                    - 'Profile.LeaveBalance.Details.Title':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =0
                                          Width: =Parent.Width
                                          Height: =Parent.Height * 0.2
                                          Text: ="Chi tiết ngày phép năm hiện tại"
                                          Color: =RGBA(17, 24, 39, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Bold
                                          Size: =14
                                          
                                    - 'Profile.LeaveBalance.Details.Info':
                                        Control: Label
                                        Properties:
                                          X: =0
                                          Y: =Parent.Height * 0.25
                                          Width: =Parent.Width
                                          Height: =Parent.Height * 0.7
                                          Text: |
                                            =If(Not(IsBlank(varUserLeaveBalance)),
                                            Concatenate(
                                              "• Tổng ngày phép được cấp:", varUserLeaveBalance.TongNgayDuocPhep, " ngày", Char(10),
                                              "• Ngày phép đã sử dụng:", varUserLeaveBalance.SoNgayDaNghi, " ngày", Char(10),
                                              "• Ngày phép còn lại:", varUserLeaveBalance.SoNgayConLai, " ngày", Char(10),
                                              "• Tỷ lệ sử dụng:", Round((varUserLeaveBalance.SoNgayDaNghi / varUserLeaveBalance.TongNgayDuocPhep) * 100, 0), "%"
                                            ),
                                            "Chưa có thông tin số ngày phép năm hiện tại"
                                            )
                                          Color: =RGBA(55, 65, 81, 1)
                                          Font: =Font.'Open Sans'
                                          Size: =12
                                          Wrap: =true
                                    
                        # History Tab
                        - 'Profile.History.Container':
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              X: =0
                              Y: =0
                              Width: =Parent.Width
                              Height: =Parent.Height
                              Visible: =varSelectedTab = "History"
                            Children:
                              - 'Profile.History.Background':
                                  Control: Rectangle
                                  Properties:
                                    X: =0
                                    Y: =0
                                    Width: =Parent.Width
                                    Height: =Parent.Height
                                    Fill: =RGBA(255, 255, 255, 1)
                                    BorderColor: =RGBA(226, 232, 240, 1)
                                    BorderThickness: =1
                                    
                              # History Header
                              - 'Profile.History.Header':
                                  Control: Label
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.02
                                    Width: =Parent.Width * 0.94
                                    Height: =Parent.Height * 0.06
                                    Text: ="Lịch sử đơn nghỉ phép"
                                    Color: =RGBA(17, 24, 39, 1)
                                    Font: =Font.'Open Sans'
                                    FontWeight: =FontWeight.Bold
                                    Size: =14
                                    
                              # History List
                              - 'Profile.History.Gallery':
                                  Control: Gallery
                                  Variant: Vertical
                                  Properties:
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.1
                                    Width: =Parent.Width * 0.94
                                    Height: =Parent.Height * 0.87
                                    Items: =SortByColumns(varUserLeaveHistory, "NgayBatDau", SortOrder.Descending)
                                    TemplateSize: =Self.Height * 0.12
                                    BorderThickness: =0
                                    Fill: =RGBA(0, 0, 0, 0)
                                  Children:
                                    - 'Profile.History.Item':
                                        Control: GroupContainer
                                        Variant: ManualLayout
                                        Properties:
                                          X: =0
                                          Y: =0
                                          Width: =Parent.TemplateWidth
                                          Height: =Parent.TemplateHeight
                                          Fill: =RGBA(255, 255, 255, 1)
                                          BorderColor: =RGBA(226, 232, 240, 1)
                                          BorderThickness: =1
                                        Children:
                                          # Period
                                          - 'Profile.History.Period':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width * 0.02
                                                Y: =Parent.Height * 0.1
                                                Width: =Parent.Width * 0.25
                                                Height: =Parent.Height * 0.4
                                                Text: =Text(ThisItem.NgayBatDau, "dd/mm/yyyy") & " - " & Text(ThisItem.NgayKetThuc, "dd/mm/yyyy")
                                                Color: =RGBA(17, 24, 39, 1)
                                                Font: =Font.'Open Sans'
                                                FontWeight: =FontWeight.Semibold
                                                Size: =11
                                                
                                          # Days
                                          - 'Profile.History.Days':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width * 0.02
                                                Y: =Parent.Height * 0.55
                                                Width: =Parent.Width * 0.25
                                                Height: =Parent.Height * 0.35
                                                Text: =ThisItem.SoNgayNghi & " ngày"
                                                Color: =RGBA(75, 85, 99, 1)
                                                Font: =Font.'Open Sans'
                                                Size: =10
                                                
                                          # Leave Type
                                          - 'Profile.History.Type':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width * 0.3
                                                Y: =Parent.Height * 0.1
                                                Width: =Parent.Width * 0.2
                                                Height: =Parent.Height * 0.4
                                                Text: =LookUp(LoaiNghi, MaLoai = ThisItem.MaLoai.Value).TenLoai
                                                Color: =RGBA(17, 24, 39, 1)
                                                Font: =Font.'Open Sans'
                                                Size: =11
                                                
                                          # Status
                                          - 'Profile.History.Status':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width * 0.55
                                                Y: =(Parent.Height - Self.Height) / 2
                                                Width: =Parent.Width * 0.18
                                                Height: =Parent.Height * 0.6
                                                Text: =Switch(ThisItem.TrangThai.Value, 
                                                  "ChoDuyetCap1", "Chờ duyệt",
                                                  "ChoDuyetCap2", "Chờ duyệt", 
                                                  "ChoDuyetCap3", "Chờ duyệt",
                                                  "DaDuyet", "Đã duyệt",
                                                  "TuChoi", "Từ chối",
                                                  "Huy", "Đã hủy",
                                                  ThisItem.TrangThai.Value)
                                                Color: =Switch(ThisItem.TrangThai.Value,
                                                  "DaDuyet", RGBA(34, 197, 94, 1),
                                                  "TuChoi", RGBA(239, 68, 68, 1),
                                                  "Huy", RGBA(107, 114, 128, 1),
                                                  RGBA(251, 191, 36, 1))
                                                Fill: =Switch(ThisItem.TrangThai.Value,
                                                  "DaDuyet", RGBA(240, 253, 244, 1),
                                                  "TuChoi", RGBA(254, 242, 242, 1),
                                                  "Huy", RGBA(249, 250, 251, 1),
                                                  RGBA(254, 243, 199, 1))
                                                BorderColor: =Switch(ThisItem.TrangThai.Value,
                                                  "DaDuyet", RGBA(34, 197, 94, 1),
                                                  "TuChoi", RGBA(239, 68, 68, 1),
                                                  "Huy", RGBA(107, 114, 128, 1),
                                                  RGBA(251, 191, 36, 1))
                                                BorderThickness: =1
                                                Font: =Font.'Open Sans'
                                                FontWeight: =FontWeight.Semibold
                                                Size: =10
                                                Align: =Align.Center
                                                
                                          # Reason (truncated)
                                          - 'Profile.History.Reason':
                                              Control: Label
                                              Properties:
                                                X: =Parent.Width * 0.75
                                                Y: =(Parent.Height - Self.Height) / 2
                                                Width: =Parent.Width * 0.23
                                                Height: =Parent.Height * 0.8
                                                Text: =If(Len(ThisItem.LyDo) > 30, Left(ThisItem.LyDo, 27) & "...", ThisItem.LyDo)
                                                Color: =RGBA(75, 85, 99, 1)
                                                Font: =Font.'Open Sans'
                                                Size: =10
                                                Wrap: =true 
